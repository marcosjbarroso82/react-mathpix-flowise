var Oe=Object.defineProperty;var Ae=(u,r,n)=>r in u?Oe(u,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):u[r]=n;var U=(u,r,n)=>Ae(u,typeof r!="symbol"?r+"":r,n);import{a as f,p as e,w as Me}from"./chunk-B7RQU5TL-mf8dp6A9.js";import{s as Z,u as $e}from"./MultiOCRWorkflowContext-Ui8IzGQR.js";import{u as V}from"./FlowiseAgentsContext-CLOlgCO7.js";import{u as Re}from"./MathpixSettingsContext-D1SeV8mS.js";import{u as Ie}from"./PromptsContext-6ZfF2ThP.js";import{M as z}from"./mathpixService-DdEer5QH.js";import{W as xe}from"./react-webcam-RucBAGRH.js";import{u as he}from"./CameraSettingsContext-Cu3MGpBM.js";import{u as se}from"./UIContext-BM-qYgXm.js";import{P as Pe}from"./PageHeader-DKlfP6W3.js";import"./index-DOzBNQ5J.js";import"./preload-helper-BCbxkQLz.js";class q{static async processWorkflow(r,n,s,o,t){var x,l,d,i,v,c,y,k,T,S,N,j,b,m,a,p,h;try{(x=t==null?void 0:t.onStepStart)==null||x.call(t,"ocr-processing"),(l=t==null?void 0:t.onProgress)==null||l.call(t,1,4,"Procesando OCR de imágenes...");const w=await this.processImagesOCR(r,o,t);if(w.some($=>$.error)){const $="Error en procesamiento OCR de algunas imágenes";throw(d=t==null?void 0:t.onStepError)==null||d.call(t,"ocr-processing",$),new Error($)}(i=t==null?void 0:t.onStepComplete)==null||i.call(t,"ocr-processing",w),(v=t==null?void 0:t.onStepStart)==null||v.call(t,"ocr-compilation"),(c=t==null?void 0:t.onProgress)==null||c.call(t,2,4,"Compilando resultados OCR...");const L=this.compileOCRResults(w);console.log("📝 Compilando texto OCR y actualizando progresivamente"),(y=t==null?void 0:t.onCompiledOCRTextUpdate)==null||y.call(t,L),(k=t==null?void 0:t.onStepComplete)==null||k.call(t,"ocr-compilation",{compiledText:L}),(T=t==null?void 0:t.onStepStart)==null||T.call(t,"question-compiler"),(S=t==null?void 0:t.onProgress)==null||S.call(t,3,4,"Procesando con agente compilador...");const M=await this.callFlowiseAgent(n,L);if(M.error)throw(N=t==null?void 0:t.onStepError)==null||N.call(t,"question-compiler",M.error),new Error(`Error en agente compilador: ${M.error}`);console.log("🧠 Agente compilador completado, actualizando progresivamente"),(j=t==null?void 0:t.onQuestionCompilerComplete)==null||j.call(t,M),(b=t==null?void 0:t.onStepComplete)==null||b.call(t,"question-compiler",M),(m=t==null?void 0:t.onStepStart)==null||m.call(t,"response-agents"),(a=t==null?void 0:t.onProgress)==null||a.call(t,4,4,"Procesando con agentes de respuesta...");const R=await this.processResponseAgents(s,M.data,t);return Object.values(R).some($=>$.error)&&((p=t==null?void 0:t.onStepError)==null||p.call(t,"response-agents","Error en algunos agentes de respuesta")),(h=t==null?void 0:t.onStepComplete)==null||h.call(t,"response-agents",R),{compiledOCRText:L,questionCompilerResult:M,responseAgentsResults:R,success:!0}}catch(w){return console.error("Error in MultiOCR Workflow:",w),{compiledOCRText:"",questionCompilerResult:null,responseAgentsResults:{},success:!1,error:w instanceof Error?w.message:"Error desconocido"}}}static async processImagesOCR(r,n,s){const o=r.map(async t=>{var x,l,d,i,v;try{(x=s==null?void 0:s.onImageOCRStart)==null||x.call(s,t.id);const c=await z.processImage(t.file,n);if(c.error)return(l=s==null?void 0:s.onImageOCRError)==null||l.call(s,t.id,c.error),{imageId:t.id,result:null,error:c.error};if((d=s==null?void 0:s.onImageOCRComplete)==null||d.call(s,t.id,c),c.data){const y=z.extractConfidence(c.data);y!==null&&((i=s==null?void 0:s.onConfidenceAvailable)==null||i.call(s,t.id,y))}return{imageId:t.id,result:c}}catch(c){const y=c instanceof Error?c.message:"Error desconocido";return(v=s==null?void 0:s.onImageOCRError)==null||v.call(s,t.id,y),{imageId:t.id,result:null,error:y}}});return Promise.all(o)}static compileOCRResults(r){let n="";return r.forEach((s,o)=>{if(s.result&&!s.error){const t=o+1;let x="";s.result.data&&(typeof s.result.data=="string"?x=s.result.data:s.result.data.text?x=s.result.data.text:s.result.data.latex?x=s.result.data.latex:x=JSON.stringify(s.result.data));const l=z.extractConfidence(s.result.data),d=l!==null?` (Confianza: ${z.formatConfidence(l)})`:"";n+=`OCR #${t} ${x}${d} FIN OCR #${t}

`}}),n.trim()}static async callFlowiseAgent(r,n){try{const s=await fetch(r.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:n.trim()})});if(!s.ok)throw new Error(`Error ${s.status}: ${s.statusText}`);return{data:await s.json()}}catch(s){return{data:null,error:s instanceof Error?s.message:"Error desconocido"}}}static async processResponseAgents(r,n,s){let o="";typeof n=="string"?o=n:n!=null&&n.text?o=n.text:o=JSON.stringify(n);const t=r.map(async d=>{var i,v;try{const c=await this.callFlowiseAgent(d,o);return console.log(`🤖 Agente de respuesta ${d.id} completado, actualizando progresivamente`),(i=s==null?void 0:s.onResponseAgentComplete)==null||i.call(s,d.id,c),{agentId:d.id,result:c}}catch(c){const y={data:null,error:c instanceof Error?c.message:"Error desconocido"};return console.log(`❌ Agente de respuesta ${d.id} falló, actualizando progresivamente`),(v=s==null?void 0:s.onResponseAgentComplete)==null||v.call(s,d.id,y),{agentId:d.id,result:y}}}),x=await Promise.all(t),l={};return x.forEach(({agentId:d,result:i})=>{l[d]=i}),l}static formatOCRResult(r){if(!r||!r.data)return"Sin resultado";let n="";typeof r.data=="string"?n=r.data:r.data.text?n=r.data.text:r.data.latex?n=r.data.latex:n=JSON.stringify(r.data,null,2);const s=z.extractConfidence(r.data);if(s!==null){const o=z.formatConfidence(s);n+=`

Confianza: ${o}`}return n}static formatAgentResult(r){var n;if(!r)return"Sin resultado";if(r.error)return`Error: ${r.error}`;if(r.data){if(r.data.lectura)return console.log("TTS: Encontrado campo lectura en data.lectura:",r.data.lectura),r.data.lectura;if(typeof r.data=="string")return r.data;if(typeof r.data=="object"){const s=t=>{if(t.lectura&&typeof t.lectura=="string")return t.lectura;for(const x in t)if(typeof t[x]=="object"&&t[x]!==null){const l=s(t[x]);if(l)return l}return null},o=s(r.data);if(o)return console.log("TTS: Encontrado campo lectura recursivamente:",o),o}}return r.lectura&&typeof r.lectura=="string"?(console.log("TTS: Encontrado campo lectura en nivel raíz:",r.lectura),r.lectura):(n=r.data)!=null&&n.text?r.data.text:(console.log("TTS: No se encontró campo lectura, devolviendo JSON completo:",r.data),JSON.stringify(r.data,null,2))}static async processDirectAgents(r,n,s,o){var t,x,l;try{(t=o==null?void 0:o.onStepStart)==null||t.call(o,"direct-agents"),(x=o==null?void 0:o.onProgress)==null||x.call(o,1,1,"Procesando con agentes directos...");const d=await this.convertImagesToUploads(r),i=await this.processDirectAgentsParallel(n,s.content,d,o);return(l=o==null?void 0:o.onStepComplete)==null||l.call(o,"direct-agents",i),{directAgentsResults:i,success:!0}}catch(d){return console.error("Error in Direct Agents Workflow:",d),{directAgentsResults:{},success:!1,error:d instanceof Error?d.message:"Error desconocido"}}}static async convertImagesToUploads(r){const n=[];for(const s of r)try{const o=await this.fileToDataURL(s.file);n.push({type:"file",name:s.name,mime:s.file.type,data:o})}catch(o){console.error(`Error converting image ${s.name} to Data URL:`,o)}return n}static fileToDataURL(r){return new Promise((n,s)=>{const o=new FileReader;o.onload=()=>{const t=o.result;typeof t=="string"?n(t):s(new Error("No se pudo leer el archivo"))},o.onerror=()=>s(o.error||new Error("Error leyendo el archivo")),o.readAsDataURL(r)})}static async processDirectAgentsParallel(r,n,s,o){const t=r.map(async d=>{var i,v;try{const c=await this.callFlowiseAgentWithUploads(d,n,s);return console.log(`🚀 Agente directo ${d.id} completado, actualizando progresivamente`),(i=o==null?void 0:o.onDirectAgentComplete)==null||i.call(o,d.id,c),{agentId:d.id,result:c}}catch(c){const y={data:null,error:c instanceof Error?c.message:"Error desconocido"};return console.log(`❌ Agente directo ${d.id} falló, actualizando progresivamente`),(v=o==null?void 0:o.onDirectAgentComplete)==null||v.call(o,d.id,y),{agentId:d.id,result:y}}}),x=await Promise.all(t),l={};return x.forEach(({agentId:d,result:i})=>{l[d]=i}),l}static async callFlowiseAgentWithUploads(r,n,s){try{const o=await fetch(r.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:n.trim(),uploads:s})});if(!o.ok)throw new Error(`Error ${o.status}: ${o.statusText}`);return{data:await o.json()}}catch(o){return{data:null,error:o instanceof Error?o.message:"Error desconocido"}}}}class ze{constructor(){U(this,"queue",[]);U(this,"isPlaying",!1);U(this,"currentUtterance",null);U(this,"isEnabled",!1);"speechSynthesis"in window||console.warn("Speech synthesis no está soportado en este navegador")}setEnabled(r){this.isEnabled=r,r||this.stop()}addToQueue(r){if(!this.isEnabled)return;const n={...r,id:`tts-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};this.queue.push(n),console.log(`TTS: Agregado a la cola - ${n.agentName}`,n.text.substring(0,100)+"..."),this.isPlaying||this.processQueue()}async processQueue(){var n,s;if(this.queue.length===0||this.isPlaying)return;const r=this.queue.shift();if(r){this.isPlaying=!0,console.log(`TTS: Iniciando lectura - ${r.agentName}`);try{await this.speak(r)}catch(o){console.error("TTS: Error en la lectura:",o),(n=r.onError)==null||n.call(r,o)}finally{this.isPlaying=!1,(s=r.onEnd)==null||s.call(r),setTimeout(()=>this.processQueue(),100)}}}speak(r){return new Promise((n,s)=>{if(!("speechSynthesis"in window)){s(new Error("Speech synthesis no está soportado"));return}speechSynthesis.cancel();const o=new SpeechSynthesisUtterance(r.text);this.currentUtterance=o;const x=speechSynthesis.getVoices().find(l=>l.lang.startsWith("es")||l.name.toLowerCase().includes("spanish")||l.name.toLowerCase().includes("español"));x&&(o.voice=x),o.rate=.9,o.pitch=1,o.volume=.8,o.onstart=()=>{var l;console.log(`TTS: Reproduciendo - ${r.agentName}`),(l=r.onStart)==null||l.call(r)},o.onend=()=>{console.log(`TTS: Completado - ${r.agentName}`),this.currentUtterance=null,n()},o.onerror=l=>{console.error("TTS: Error en utterance:",l),this.currentUtterance=null,s(new Error(`Error de speech synthesis: ${l.error}`))},speechSynthesis.speak(o)})}stop(){speechSynthesis.cancel(),this.queue=[],this.isPlaying=!1,this.currentUtterance=null,console.log("TTS: Detenido y cola limpiada")}pause(){this.isPlaying&&speechSynthesis.pause()}resume(){this.isPlaying&&speechSynthesis.resume()}getStatus(){return{isEnabled:this.isEnabled,isPlaying:this.isPlaying,queueLength:this.queue.length,currentItem:this.queue[0]||null}}clearQueue(){this.queue=[],console.log("TTS: Cola limpiada")}reset(){speechSynthesis.cancel(),this.queue=[],this.isPlaying=!1,this.currentUtterance=null,console.log("TTS: Estado completamente reseteado")}}const W=new ze;function me(u,r){let n="";if(r!=null&&r.data&&typeof r.data=="string"){const s=r.data.match(/Confianza: (\d+%)/g);s&&s.length>0&&(n=` Confianza promedio del OCR: ${s.map(t=>t.replace("Confianza: ","")).join(", ")}.`)}return u+n}function We({enabled:u,responseAgentsResults:r,directAgentsResults:n={},agents:s,isRunning:o=!1,images:t=[]}){const x=f.useRef({}),l=f.useRef(new Set),d=f.useRef(new Set);f.useEffect(()=>{W.setEnabled(u)},[u]),f.useEffect(()=>{o&&(l.current.clear(),d.current.clear(),x.current={},W.reset(),console.log("TTS: Estados reseteados para nuevo workflow"))},[o]),f.useEffect(()=>{if(!u)return;const j=t.filter(b=>b.status==="completed"&&b.ocrResult&&!d.current.has(b.id));if(j.length>0){console.log(`TTS: Detectadas ${j.length} imágenes con OCR completado`);const b=j.map(p=>p.ocrResult);let m="";const a=[];b.forEach((p,h)=>{if(p!=null&&p.data){const w=z.extractConfidence(p.data);if(w!==null){const A=z.formatConfidence(w);a.push(`Imagen ${h+1}: ${A}`)}}}),a.length>0?(a.length===1?m=`Confianza OCR:: ${a[0]}.`:m=`${a.length} imágenes. Confianza OCR: ${a.join(", ")}.`,W.addToQueue({text:m,agentName:"Sistema",onStart:()=>console.log("TTS: Iniciando lectura automática de información de confianza"),onEnd:()=>{console.log("TTS: Completada lectura automática de información de confianza"),j.forEach(p=>d.current.add(p.id))},onError:p=>{console.error("TTS: Error leyendo información de confianza automáticamente:",p),j.forEach(h=>d.current.add(h.id))}})):j.forEach(p=>d.current.add(p.id))}},[t,u]),f.useEffect(()=>{if(!u)return;const j={...r,...n};Object.entries(j).forEach(([b,m])=>{const a=x.current[b],p=!a||JSON.stringify(a)!==JSON.stringify(m),h=m==null?void 0:m.error,w=!l.current.has(b);if(p&&!h&&w){const A=s.find(R=>R.id===b),L=A?A.name:`Agente ${b}`,M=q.formatAgentResult(m);if(M&&M!=="Sin resultado"){console.log(`TTS: Agregando resultado de ${L} a la cola`);const R=me(M,m);W.addToQueue({text:R,agentName:L,onStart:()=>{console.log(`TTS: Iniciando lectura de ${L}`)},onEnd:()=>{console.log(`TTS: Completada lectura de ${L}`),l.current.add(b)},onError:F=>{console.error(`TTS: Error leyendo ${L}:`,F),l.current.add(b)}})}}}),x.current={...j}},[r,n,s,u]),f.useEffect(()=>{u||(l.current.clear(),d.current.clear(),x.current={},W.reset())},[u]),f.useEffect(()=>{Object.keys(r).length===0&&Object.keys(n).length===0&&(l.current.clear(),d.current.clear(),x.current={})},[r,n]);const i=f.useCallback((j,b)=>{if(!u)return;const m=s.find(h=>h.id===j),a=m?m.name:`Agente ${j}`,p=q.formatAgentResult(b);if(p&&p!=="Sin resultado"){const h=me(p,b);W.addToQueue({text:h,agentName:a,onStart:()=>console.log(`TTS: Lectura manual iniciada - ${a}`),onEnd:()=>console.log(`TTS: Lectura manual completada - ${a}`),onError:w=>console.error(`TTS: Error en lectura manual - ${a}:`,w)})}},[u,s]),v=f.useCallback(j=>{if(!u)return;let b="Información de confianza del OCR: ";const m=[];j.forEach((a,p)=>{if(a!=null&&a.data){const h=z.extractConfidence(a.data);if(h!==null){const w=z.formatConfidence(h);m.push(`Imagen ${p+1}: ${w}`)}}}),m.length>0&&(b+=m.join(", ")+".",W.addToQueue({text:b,agentName:"Sistema",onStart:()=>console.log("TTS: Iniciando lectura de información de confianza"),onEnd:()=>console.log("TTS: Completada lectura de información de confianza"),onError:a=>console.error("TTS: Error leyendo información de confianza:",a)}))},[u]),c=f.useCallback(()=>{W.stop(),l.current.clear(),d.current.clear()},[]),y=f.useCallback(()=>{W.pause()},[]),k=f.useCallback(()=>{W.resume()},[]),T=f.useCallback(()=>{W.clearQueue()},[]),S=f.useCallback(()=>W.getStatus(),[]),N=f.useCallback((j,b)=>{if(!u)return;const m=`Confianza OCR: ${z.formatConfidence(b)}.`;console.log(`TTS: Leyendo confianza inmediata para imagen ${j}: ${m}`),W.addToQueue({text:m,agentName:"Sistema",onStart:()=>console.log(`TTS: Iniciando lectura inmediata de confianza para imagen ${j}`),onEnd:()=>console.log(`TTS: Completada lectura inmediata de confianza para imagen ${j}`),onError:a=>console.error(`TTS: Error leyendo confianza inmediata para imagen ${j}:`,a)})},[u]);return{speakAgentResult:i,speakConfidenceInfo:v,speakConfidenceImmediate:N,stopTTS:c,pauseTTS:y,resumeTTS:k,clearTTSQueue:T,getTTSStatus:S}}function De({onFilesSelect:u,maxFiles:r,currentFileCount:n,isProcessing:s,disabled:o=!1}){const t=f.useRef(null),[x,l]=f.useState(!1),d=Math.max(0,r-n),i=d>0&&!o&&!s,v=f.useCallback(m=>{const a=Array.from(m),p=[],h=[];if(a.forEach(w=>{const A=z.validateImageFile(w);A.valid?p.push(w):h.push(`${w.name}: ${A.error}`)}),h.length>0&&alert(`Algunos archivos no son válidos:
${h.join(`
`)}`),p.length>0){const w=p.slice(0,d);u(w),w.length<p.length&&alert(`Se seleccionaron ${w.length} de ${p.length} archivos válidos debido al límite de ${r} imágenes.`)}},[u,d,r]),c=f.useCallback(m=>{m.target.files&&m.target.files.length>0&&v(m.target.files),m.target.value=""},[v]),y=f.useCallback(m=>{if(m.preventDefault(),m.stopPropagation(),l(!1),!i)return;const a=m.dataTransfer.files;a&&a.length>0&&v(a)},[v,i]),k=f.useCallback(m=>{m.preventDefault(),m.stopPropagation()},[]),T=f.useCallback(m=>{m.preventDefault(),m.stopPropagation(),i&&l(!0)},[i]),S=f.useCallback(m=>{m.preventDefault(),m.stopPropagation(),l(!1)},[]),N=f.useCallback(()=>{i&&t.current&&t.current.click()},[i]),j=()=>s?"Procesando...":o?"Deshabilitado":d===0?`Máximo ${r} imágenes alcanzado`:`Selecciona hasta ${d} imagen${d!==1?"es":""} más`,b=()=>s?"text-blue-600":o||d===0?"text-gray-500":"text-gray-700";return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:"Subir Múltiples Imágenes"}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[n,"/",r," imágenes"]})]}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-all duration-200 ${i?x?"border-blue-500 dark:border-blue-400 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 cursor-pointer":"border-gray-300 dark:border-gray-600 cursor-not-allowed opacity-50"}`,onDrop:y,onDragOver:k,onDragEnter:T,onDragLeave:S,onClick:N,children:[e.jsx("div",{className:`w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center ${i?"bg-blue-100 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700"}`,children:e.jsx("svg",{className:`w-8 h-8 ${i?"text-blue-600 dark:text-blue-400":"text-gray-400"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 12l3 3m0 0l3-3m-3 3V9"})})}),e.jsx("p",{className:"text-lg font-medium mb-2",style:{color:i?"var(--color-text-primary)":"var(--color-text-secondary)"},children:x?"Suelta las imágenes aquí":"Arrastra imágenes aquí o haz clic para seleccionar"}),e.jsx("p",{className:`text-sm mb-4 ${b()}`,children:j()}),e.jsx("p",{className:"text-xs mb-4",style:{color:"var(--color-text-secondary)"},children:"Soporta JPG, PNG, GIF, BMP, WebP y PDF (máximo 10MB por archivo)"}),e.jsx("button",{className:`px-6 py-2 rounded-lg transition-colors duration-200 ${i?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,disabled:!i,type:"button",children:s?"Procesando...":"Seleccionar Archivos"})]}),n>0&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-sm text-green-800 dark:text-green-200 font-medium",children:[n," imagen",n!==1?"es":""," seleccionada",n!==1?"s":""]})]})}),e.jsx("input",{ref:t,type:"file",accept:"image/*,.pdf",multiple:!0,onChange:c,className:"hidden",disabled:!i})]})}function Fe({onImagesCapture:u,maxFiles:r,currentFileCount:n,isProcessing:s,disabled:o=!1,onWorkflowReset:t}){const x=f.useRef(null),[l,d]=f.useState(null),[i,v]=f.useState(!1),[c,y]=f.useState([]),[k,T]=f.useState({}),{settings:S}=he(),{uiSettings:N}=se(),j={width:S.videoConstraints.width,height:S.videoConstraints.height,facingMode:S.videoConstraints.facingMode},b=Math.max(0,r-n),m=b>0&&!o&&!s&&!i;f.useEffect(()=>{if(t){const L=()=>{y([]),T({}),d(null),v(!1),console.log("🔄 MultiCameraCapture: Estado limpiado por reset del workflow")};t.cleanupCameraState=L}},[t]);const a=f.useCallback(async()=>{if(!(!x.current||!m)){v(!0),d(null);try{await new Promise(M=>setTimeout(M,S.focusDelay*1e3));const L=x.current.getScreenshot({width:S.videoConstraints.width,height:S.videoConstraints.height});if(L){const R=await(await fetch(L)).blob(),F=new File([R],`camera-capture-${Date.now()}.${S.screenshotFormat.split("/")[1]}`,{type:S.screenshotFormat}),$=[...c,F];y($);const O=`${F.name}-${Date.now()}`;T(D=>({...D,[O]:"Subiendo a Supabase..."})),Z.uploadPhotoAsync(F).then(D=>{D.success?T(H=>({...H,[O]:`✓ Subida exitosa: ${D.path}`})):T(H=>({...H,[O]:`✗ Error: ${D.error}`}))}).catch(D=>{T(H=>({...H,[O]:`✗ Error: ${D.message}`}))}),$.length>=b&&(u($),y([]))}}catch(L){d("Error al capturar la imagen"),console.error("Error capturing image:",L)}finally{v(!1)}}},[S,m,c,b,u]),p=f.useCallback(()=>{c.length>0&&(u(c),y([]))},[c,u]),h=f.useCallback(()=>{y([]),T({})},[]),w=f.useCallback(()=>{T({})},[]),A=o||s||i;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[!N.compactMode&&e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:"Capturar con Cámara"}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[n+c.length,"/",r," imágenes"]})]}),l&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-200 rounded-md",children:l}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{ref:x,audio:!1,videoConstraints:j,className:`w-full h-auto rounded-lg ${A?"opacity-50":""}`,style:{maxHeight:"60vh"},onUserMediaError:L=>{d("Error al acceder a la cámara. Verifica los permisos."),console.error("Webcam error:",L)}}),(i||s)&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"text-white text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-2"}),e.jsx("p",{children:i?"Enfocando...":"Procesando..."})]})})]}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:a,disabled:!m,className:`flex-1 px-6 py-3 rounded-lg font-medium transition-colors duration-200 ${m?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,children:i?"Enfocando...":s?"Procesando...":"Capturar Foto"}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:p,disabled:s,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200",children:["Procesar ",c.length," foto",c.length!==1?"s":""]}),e.jsx("button",{onClick:h,disabled:s,className:"px-4 py-3 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200",children:"Limpiar"})]})]}),Object.keys(k).length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"Estado de subidas a Supabase"})]}),e.jsx("button",{onClick:w,className:"text-xs px-2 py-1 bg-blue-200 dark:bg-blue-800 text-blue-800 dark:text-blue-200 rounded hover:bg-blue-300 dark:hover:bg-blue-700",children:"Limpiar"})]}),e.jsx("div",{className:"space-y-1",children:Object.entries(k).map(([L,M])=>e.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:M},L))})]}),c.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L3.354 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:[c.length," foto",c.length!==1?"s":""," capturada",c.length!==1?"s":""," pendiente",c.length!==1?"s":""," de procesar"]})]}),e.jsx("div",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:'Haz clic en "Procesar" para agregar a la lista de imágenes o "Capturar Foto" para tomar más.'})]}),e.jsx("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("div",{children:["Resolución: ",S.videoConstraints.width,"x",S.videoConstraints.height]}),e.jsxs("div",{children:["Cámara: ",S.videoConstraints.facingMode==="environment"?"Trasera":"Frontal"]}),e.jsxs("div",{children:["Formato: ",S.screenshotFormat]}),e.jsxs("div",{children:["Calidad: ",S.screenshotQuality]}),e.jsxs("div",{children:["Delay: ",S.focusDelay,"s"]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Supabase:"}),e.jsx("span",{className:`px-1 py-0.5 rounded text-xs ${Z.isConfigured()?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200"}`,children:Z.isConfigured()?"Configurado":"No configurado"})]})]})})]})}function _({label:u,selectedAgentId:r,selectedAgentIds:n=[],onAgentSelect:s,onAgentsSelect:o,multiple:t=!1,disabled:x=!1,placeholder:l="Selecciona un agente...",helpText:d,required:i=!1}){var S;const{agents:v,isLoading:c}=V(),y=N=>{s&&s(N)},k=(N,j)=>{o&&o(j?[...n,N]:n.filter(b=>b!==N))},T=()=>{var N;return t?n.map(j=>{var b;return(b=v.find(m=>m.id===j))==null?void 0:b.name}).filter(Boolean).join(", "):((N=v.find(j=>j.id===r))==null?void 0:N.name)||""};return c?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--color-text-primary)"},children:[u," ",i&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700",children:e.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Cargando agentes..."})})]}):v.length===0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--color-text-primary)"},children:[u," ",i&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700",children:e.jsx("span",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"No hay agentes configurados"})}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Ve a Configuración para agregar agentes de Flowise"})]}):t?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--color-text-primary)"},children:[u," ",i&&e.jsx("span",{className:"text-red-500",children:"*"})]}),n.length>0&&e.jsxs("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:[e.jsxs("div",{className:"text-xs text-blue-800 dark:text-blue-200 font-medium mb-1",children:[n.length," agente",n.length!==1?"s":""," seleccionado",n.length!==1?"s":"",":"]}),e.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:T()})]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-2",children:v.map(N=>{const j=n.includes(N.id);return e.jsxs("label",{className:`flex items-start space-x-3 p-2 rounded cursor-pointer transition-colors ${x?"opacity-50 cursor-not-allowed":"hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsx("input",{type:"checkbox",checked:j,onChange:b=>k(N.id,b.target.checked),disabled:x,className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:N.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:N.url})]})]},N.id)})}),d&&e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:d})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--color-text-primary)"},children:[u," ",i&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r,onChange:N=>y(N.target.value),disabled:x,className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white ${x?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"",children:l}),v.map(N=>e.jsx("option",{value:N.id,children:N.name},N.id))]}),r&&e.jsxs("div",{className:"p-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md",children:[e.jsx("div",{className:"text-xs text-green-800 dark:text-green-200 font-medium",children:"Agente seleccionado:"}),e.jsx("div",{className:"text-xs text-green-700 dark:text-green-300",children:T()}),e.jsx("div",{className:"text-xs text-green-600 dark:text-green-400 truncate mt-1",children:(S=v.find(N=>N.id===r))==null?void 0:S.url})]}),d&&e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:d})]})}function Be({images:u,workflowSteps:r,compiledOCRText:n,questionCompilerResult:s,responseAgentsResults:o,directAgentsResults:t={},isRunning:x,enableTTS:l=!1,onSpeakAgentResult:d,onSpeakConfidenceInfo:i,onSpeakConfidenceImmediate:v,onStopTTS:c,onPauseTTS:y,onResumeTTS:k,onClearTTSQueue:T,getTTSStatus:S}){const{agents:N}=V(),j=a=>{switch(a){case"pending":return e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"⏳"})});case"processing":return e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center",children:e.jsxs("svg",{className:"w-4 h-4 text-blue-600 dark:text-blue-400 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})});case"completed":return e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})});case"error":return e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 dark:bg-red-900 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}},b=a=>{switch(a){case"pending":return"⏳";case"processing":return"🔄";case"completed":return"✅";case"error":return"❌"}},m=(a,p)=>a?`${(((p||new Date).getTime()-a.getTime())/1e3).toFixed(1)}s`:"";return e.jsxs("div",{className:"space-y-6",children:[u.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:"Estado de las Imágenes"}),l&&i&&e.jsxs("button",{onClick:()=>{const a=u.filter(p=>p.status==="completed"&&p.ocrResult).map(p=>p.ocrResult);i(a)},className:"px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors duration-200 flex items-center space-x-1",title:"Leer información de confianza del OCR",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 4.663 12 5.109 12 6v12c0 .891-1.077 1.337-1.707.707L5.586 15z"})}),e.jsx("span",{children:"Leer Confianza"})]})]}),e.jsx("div",{className:"space-y-3",children:u.map((a,p)=>{var h,w;return e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg",style:{backgroundColor:"var(--color-surface)"},children:[e.jsx("span",{className:"text-lg",children:b(a.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:["Imagen #",p+1,": ",a.name]}),e.jsxs("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[(a.size/1024/1024).toFixed(2)," MB"]})]}),a.status==="completed"&&a.ocrResult&&e.jsxs("div",{className:"mt-2 p-2 bg-green-50 dark:bg-green-900/20 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-green-800 dark:text-green-200 mb-1",children:"Resultado OCR:"}),e.jsx("div",{className:"text-green-700 dark:text-green-300 max-h-20 overflow-y-auto",children:q.formatOCRResult(a.ocrResult)}),((h=a.ocrResult)==null?void 0:h.data)&&(()=>{const A=z.extractConfidence(a.ocrResult.data);if(A!==null){const L=z.formatConfidence(A),M=A>=.8?"text-green-600 dark:text-green-400":A>=.6?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400";return e.jsxs("div",{className:`mt-1 font-medium ${M}`,children:["🎯 Confianza: ",L]})}return null})()]}),a.status==="error"&&((w=a.ocrResult)==null?void 0:w.error)&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 dark:bg-red-900/20 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-red-800 dark:text-red-200 mb-1",children:"Error:"}),e.jsx("div",{className:"text-red-700 dark:text-red-300",children:a.ocrResult.error})]})]})]},a.id)})})]}),r.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Progreso del Workflow"}),e.jsx("div",{className:"space-y-4",children:r.map((a,p)=>e.jsxs("div",{className:"flex items-start space-x-4",children:[j(a.status),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:a.name}),a.startTime&&e.jsx("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:m(a.startTime,a.endTime)})]}),a.status==="error"&&a.error&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",children:[e.jsx("div",{className:"text-sm text-red-800 dark:text-red-200 font-medium",children:"Error:"}),e.jsx("div",{className:"text-sm text-red-700 dark:text-red-300",children:a.error})]}),a.status==="completed"&&a.result&&e.jsx("div",{className:"mt-2 text-xs",style:{color:"var(--color-text-secondary)"},children:"✓ Completado exitosamente"})]}),p<r.length-1&&e.jsx("div",{className:"absolute left-4 top-8 w-px h-6 bg-gray-300 dark:bg-gray-600",style:{marginTop:"2rem"}})]},a.id))})]}),n&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:"Texto OCR Compilado"}),x&&e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-green-600 dark:text-green-400",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Actualizado progresivamente"})]})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:e.jsx("pre",{className:"text-sm whitespace-pre-wrap overflow-x-auto",style:{color:"var(--color-text-primary)"},children:n})})]}),s&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:"Resultado del Agente Compilador"}),x&&e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-green-600 dark:text-green-400",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Actualizado progresivamente"})]})]}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsx("pre",{className:"text-sm whitespace-pre-wrap overflow-x-auto text-blue-800 dark:text-blue-200",children:q.formatAgentResult(s)})})]}),Object.keys(o).length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:"Resultados de Agentes de Respuesta"}),l&&e.jsx("div",{className:"flex items-center space-x-2",children:S&&(()=>{const a=S();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.isPlaying?"Reproduciendo...":a.queueLength>0?`En cola: ${a.queueLength}`:"TTS listo"}),e.jsxs("div",{className:"flex space-x-1",children:[a.isPlaying?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:y,className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",title:"Pausar TTS",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("button",{onClick:k,className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",title:"Reanudar TTS",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h1m4 0h1m-6-8h8a2 2 0 012 2v8a2 2 0 01-2 2H8a2 2 0 01-2-2V6a2 2 0 012-2z"})})})]}):e.jsx("button",{onClick:y,className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",title:"Pausar TTS",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("button",{onClick:c,className:"p-1 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-200",title:"Detener TTS",children:e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 10h6v4H9z"})]})}),e.jsx("button",{onClick:T,className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",title:"Limpiar cola TTS",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})})()})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(o).map(([a,p])=>{const h=N.find(A=>A.id===a),w=h?h.name:`Agente ${a}`;return e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"text-sm font-medium text-purple-800 dark:text-purple-200",children:w}),x&&e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Progresivo"})]})]}),l&&d&&e.jsx("button",{onClick:()=>d(a,p),className:"p-1 text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-200",title:"Leer respuesta con TTS",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 4.663 12 5.109 12 6v12c0 .891-1.077 1.337-1.707.707L5.586 15z"})})})]}),h&&e.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-400 mb-2 truncate",children:h.url}),e.jsx("pre",{className:"text-sm whitespace-pre-wrap overflow-x-auto text-purple-700 dark:text-purple-300",children:q.formatAgentResult(p)})]},a)})})]}),Object.keys(t).length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:"Resultados de Agentes Directos"}),l&&e.jsx("div",{className:"flex items-center space-x-2",children:S&&(()=>{const a=S();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.isPlaying?"Reproduciendo...":a.queueLength>0?`En cola: ${a.queueLength}`:"TTS listo"}),e.jsxs("div",{className:"flex space-x-1",children:[a.isPlaying?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:y,className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",title:"Pausar TTS",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("button",{onClick:k,className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",title:"Reanudar TTS",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h1m4 0h1m-6-8h8a2 2 0 012 2v8a2 2 0 01-2 2H8a2 2 0 01-2-2V6a2 2 0 012-2z"})})})]}):e.jsx("button",{onClick:y,className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",title:"Pausar TTS",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("button",{onClick:c,className:"p-1 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-200",title:"Detener TTS",children:e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 10h6v4H9z"})]})}),e.jsx("button",{onClick:T,className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",title:"Limpiar cola TTS",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})})()})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(t).map(([a,p])=>{const h=N.find(A=>A.id===a),w=h?h.name:`Agente ${a}`;return e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:w}),x&&e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Progresivo"})]})]}),l&&d&&e.jsx("button",{onClick:()=>d(a,p),className:"p-1 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200",title:"Leer respuesta con TTS",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 4.663 12 5.109 12 6v12c0 .891-1.077 1.337-1.707.707L5.586 15z"})})})]}),h&&e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 mb-2 truncate",children:h.url}),e.jsx("pre",{className:"text-sm whitespace-pre-wrap overflow-x-auto text-blue-700 dark:text-blue-300",children:q.formatAgentResult(p)})]},a)})})]}),x&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"Ejecutando workflow..."})]}),e.jsx("div",{className:"mt-2 text-xs text-blue-700 dark:text-blue-300",children:"💡 Los resultados se mostrarán progresivamente conforme cada agente termine"})]})]})}const ge=()=>typeof window<"u"&&window.location.pathname.includes("/react-mathpix-flowise")?"/react-mathpix-flowise":"",ee=()=>{try{const r=`${ge()}/sounds/click.mp3`;console.log("Reproduciendo sonido de click desde:",r);const n=new Audio(r);n.volume=.5,n.play().catch(s=>{console.log("No se pudo reproducir el sonido de click:",s)})}catch(u){console.log("Error al reproducir sonido de click:",u)}},re=u=>{try{const n=`${ge()}/sounds/${u}`;console.log("Reproduciendo sonido de hover desde:",n);const s=new Audio(n);return s.volume=.3,s.loop=!0,s.play().catch(o=>{console.log("No se pudo reproducir el sonido de hover:",o)}),s}catch(r){return console.log("Error al reproducir sonido de hover:",r),null}},te=u=>{if(u)try{u.pause(),u.currentTime=0}catch(r){console.log("Error al detener sonido de hover:",r)}};function qe({imagesCount:u,maxImages:r,isRunning:n,canRunWorkflow:s,onTakePhoto:o,onRunWorkflow:t,onReset:x}){const{settings:l}=he(),{uiSettings:d}=se(),i=f.useRef(null),v=f.useRef(null),c=f.useRef(null),y=f.useRef(null),k=u<r&&!n,T=f.useCallback(async()=>{if(!(!k||!i.current)){ee();try{await new Promise(b=>setTimeout(b,l.focusDelay*1e3));const j=i.current.getScreenshot({width:l.videoConstraints.width,height:l.videoConstraints.height});if(j){const m=await(await fetch(j)).blob();console.log("WorkflowShortcuts - Blob size:",m.size,"bytes"),console.log("WorkflowShortcuts - Blob type:",m.type);const a=new File([m],`camera-capture-${Date.now()}.${l.screenshotFormat.split("/")[1]}`,{type:l.screenshotFormat});console.log("WorkflowShortcuts - File created:",a.name,"size:",a.size,"type:",a.type),o(a)}}catch(j){console.error("Error en captura automática:",j)}}},[l,k,o]),S=f.useCallback(()=>{s&&(ee(),t())},[s,t]),N=f.useCallback(()=>{ee(),x()},[x]);return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          @keyframes fastBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
          }
          .hover-fast-blink:hover {
            animation: fastBlink 0.3s infinite;
          }
        `}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[!d.compactMode&&e.jsx("h2",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"⚡ Atajos de Ejecución"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[e.jsxs("button",{onClick:T,onMouseEnter:()=>{k&&(v.current=re("Foto.mp3"))},onMouseLeave:()=>{te(v.current),v.current=null},disabled:!k,className:`px-3 py-6 rounded-lg font-medium transition-all duration-100 flex items-center justify-center space-x-2 hover-fast-blink ${k?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,children:[e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:"Tomar Foto"})]}),e.jsxs("button",{onClick:N,onMouseEnter:()=>{y.current=re("reiniciar.mp3")},onMouseLeave:()=>{te(y.current),y.current=null},className:"px-3 py-6 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-all duration-100 flex items-center justify-center space-x-2 hover-fast-blink",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:n?"Cancelar":"Reiniciar"})]}),e.jsxs("button",{onClick:S,onMouseEnter:()=>{s&&(c.current=re("Procesar.mp3"))},onMouseLeave:()=>{te(c.current),c.current=null},disabled:!s,className:`px-3 py-6 rounded-lg font-medium transition-all duration-100 flex items-center justify-center space-x-2 hover-fast-blink ${s?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsx("span",{children:"Procesar y Limpiar"}),u>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-white/20 rounded-full text-xs font-bold",children:u})]})]}),e.jsx("div",{className:"mt-3 text-xs",style:{color:"var(--color-text-secondary)"},children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Imágenes: ",u,"/",r]}),e.jsxs("span",{children:["Estado: ",n?"Ejecutando...":"Listo"]})]})}),e.jsx("div",{style:{position:"absolute",opacity:0,pointerEvents:"none",zIndex:-1},children:e.jsx(xe,{ref:i,audio:!1,videoConstraints:{width:l.videoConstraints.width,height:l.videoConstraints.height,facingMode:l.videoConstraints.facingMode},onUserMediaError:j=>{console.error("Webcam error:",j)}})})]})]})}function He({responseAgentsResults:u,directAgentsResults:r={}}){const{agents:n}=V(),{uiSettings:s}=se(),o=i=>{if(!i||i.error)return(i==null?void 0:i.error)||"Sin resultado";if(i.data){if(i.data.lectura)return i.data.lectura;if(typeof i.data=="string")return i.data;if(typeof i.data=="object"){const v=y=>{if(y.lectura&&typeof y.lectura=="string")return y.lectura;for(const k in y)if(typeof y[k]=="object"&&y[k]!==null){const T=v(y[k]);if(T)return T}return null},c=v(i.data);if(c)return c}}return i.lectura&&typeof i.lectura=="string"?i.lectura:'Campo "lectura" no encontrado en la respuesta'},t=Object.keys(u).length>0,x=Object.keys(r).length>0,l=Object.values(u).some(i=>i&&!i.error&&o(i)!=="Sin resultado"),d=Object.values(r).some(i=>i&&!i.error&&o(i)!=="Sin resultado");return(!t||!l)&&(!x||!d)?null:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[!s.compactMode&&e.jsx("h2",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"📋 Resumen de Resultados"}),e.jsxs("div",{className:"space-y-6",children:[l&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium mb-3",style:{color:"var(--color-text-primary)"},children:"📄 Resultados Mathpix OCR"}),e.jsx("div",{className:"space-y-4",children:Object.entries(u).map(([i,v])=>{const c=n.find(T=>T.id===i),y=c?c.name:`Agente ${i}`,k=o(v);return!k||k==="Sin resultado"?null:e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:y}),e.jsx("div",{className:"text-xs text-green-600 dark:text-green-400",children:"Lectura"})]}),e.jsx("div",{className:"text-sm text-green-700 dark:text-green-300 whitespace-pre-wrap",children:k})]},i)})})]}),d&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium mb-3",style:{color:"var(--color-text-primary)"},children:"🚀 Resultados Agentes Directos"}),e.jsx("div",{className:"space-y-4",children:Object.entries(r).map(([i,v])=>{const c=n.find(T=>T.id===i),y=c?c.name:`Agente ${i}`,k=o(v);return!k||k==="Sin resultado"?null:e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:y}),e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400",children:"Lectura"})]}),e.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300 whitespace-pre-wrap",children:k})]},i)})})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-xs text-blue-700 dark:text-blue-300",children:'Mostrando solo el campo "lectura" de las respuestas de los agentes'})]})})]})}function sr({}){return[{title:"Multi-OCR Workflow - Procesamiento Avanzado"},{name:"description",content:"Workflow avanzado para procesar múltiples imágenes con OCR y agentes de IA"}]}const or=Me(function(){var le;const{config:r,updateConfig:n,saveConfig:s,images:o,addImages:t,removeImage:x,clearImages:l,updateImageStatus:d,workflowSteps:i,updateWorkflowStep:v,initializeWorkflowSteps:c,resetWorkflow:y,compiledOCRText:k,setCompiledOCRText:T,questionCompilerResult:S,setQuestionCompilerResult:N,responseAgentsResults:j,setResponseAgentResult:b,directAgentsResults:m,setDirectAgentResult:a,clearResults:p,isRunning:h,setIsRunning:w,cancelWorkflow:A,resetImages:L,resetAll:M,resetWorkflowCompletely:R,processImageOCRImmediate:F}=$e(),{agents:$}=V(),{settings:O}=Re(),{prompts:D}=Ie(),{speakAgentResult:H,speakConfidenceInfo:pe,speakConfidenceImmediate:Q,stopTTS:fe,pauseTTS:ye,resumeTTS:je,clearTTSQueue:ve,getTTSStatus:be}=We({enabled:r.enableTTS,responseAgentsResults:j,directAgentsResults:m,agents:$,isRunning:h,images:o}),oe=f.useCallback(async g=>{if(!r.immediateOCR||!O.appId||!O.appKey)return;console.log("🚀 Procesando OCR inmediato para",g.length,"imágenes");const E={appId:O.appId,appKey:O.appKey,includeMath:O.includeMath,outputFormats:O.outputFormats},G={onImageOCRStart:I=>{console.log("🔄 Iniciando OCR inmediato para imagen:",I)},onImageOCRComplete:(I,B)=>{console.log("✅ OCR inmediato completado para imagen:",I)},onImageOCRError:(I,B)=>{console.error("❌ Error en OCR inmediato para imagen:",I,B)},onConfidenceAvailable:(I,B)=>{console.log("🎯 Confianza inmediata disponible para imagen:",I,B),Q(I,B)}};for(const I of g)I.status==="pending"&&await F(I.id,E,G)},[r.immediateOCR,O,F,Q]);f.useEffect(()=>{if(console.log("🔍 useEffect OCR inmediato ejecutándose:",{immediateOCR:r.immediateOCR,imagesCount:o.length,mathpixConfigured:!!(O.appId&&O.appKey)}),r.immediateOCR&&o.length>0){const g=o.filter(E=>E.status==="pending");console.log("📋 Imágenes encontradas:",{total:o.length,pending:g.length,pendingIds:g.map(E=>E.id)}),g.length>0&&(console.log("🔍 Detectadas",g.length,"imágenes pendientes para OCR inmediato"),oe(g))}},[o,r.immediateOCR,oe,O.appId,O.appKey]);const J=f.useCallback(g=>{t(g)},[t]),[ne,Ne]=f.useState(!1),we=g=>{const E={...r,questionCompilerAgentId:g};n(E),s(E)},Ce=g=>{const E={...r,responseAgentIds:g};n(E),s(E)},ke=g=>{const E={...r,enableTTS:g};n(E),s(E)},Se=g=>{const E={...r,directAgentsIds:g};n(E),s(E)},Te=g=>{const E={...r,selectedPromptId:g};n(E),s(E)},Ee=g=>{const E={...r,immediateOCR:g};n(E),s(E)},ae=f.useCallback(()=>{const g=[];return(!O.appId||!O.appKey)&&g.push("Configuración de Mathpix incompleta"),r.questionCompilerAgentId||g.push("Agente compilador de preguntas no seleccionado"),r.responseAgentIds.length===0&&g.push("No hay agentes de respuesta seleccionados"),r.directAgentsIds.length>0&&!r.selectedPromptId&&g.push("Debe seleccionar un prompt para los agentes directos"),o.length===0&&g.push("No hay imágenes para procesar"),Ne(g.length>0),g},[O,r,o]),K=f.useCallback(async()=>{const g=ae();if(g.length>0){alert(`No se puede ejecutar el workflow:
${g.join(`
`)}`);return}w(!0),p(),c();try{const E=$.find(C=>C.id===r.questionCompilerAgentId),G=$.filter(C=>r.responseAgentIds.includes(C.id)),I=$.filter(C=>r.directAgentsIds.includes(C.id)),B=D.find(C=>C.id===r.selectedPromptId);if(!E)throw new Error("Agente compilador no encontrado");const ce={onImageOCRStart:C=>{d(C,"processing")},onImageOCRComplete:(C,P)=>{d(C,"completed",P)},onImageOCRError:(C,P)=>{d(C,"error",{status:0,data:null,error:P})},onStepStart:C=>{v(C,{status:"processing",startTime:new Date})},onStepComplete:(C,P)=>{v(C,{status:"completed",endTime:new Date,result:P})},onStepError:(C,P)=>{v(C,{status:"error",endTime:new Date,error:P})},onCompiledOCRTextUpdate:C=>{console.log("🔄 Actualizando texto OCR compilado progresivamente"),T(C)},onQuestionCompilerComplete:C=>{console.log("✅ Agente compilador completado progresivamente"),N(C)},onResponseAgentComplete:(C,P)=>{console.log(`🤖 Agente de respuesta ${C} completado progresivamente`),b(C,P)},onDirectAgentComplete:(C,P)=>{console.log(`🚀 Agente directo ${C} completado progresivamente`),a(C,P)},onConfidenceAvailable:(C,P)=>{console.log(`🎯 Confianza disponible inmediatamente para imagen ${C}: ${P}`),Q(C,P)}},X=[];X.push(q.processWorkflow(o,E,G,{appId:O.appId,appKey:O.appKey,includeMath:O.includeMath,outputFormats:O.outputFormats},ce)),I.length>0&&B&&X.push(q.processDirectAgents(o,I,B,ce));const Y=await Promise.all(X),ue=Y[0];if(ue.success||alert(`Error en el workflow Mathpix OCR: ${ue.error}`),Y.length>1){const C=Y[1];C.success||alert(`Error en el workflow Directo a Agentes: ${C.error}`)}}catch(E){console.error("Error executing workflow:",E),alert(`Error inesperado: ${E instanceof Error?E.message:"Error desconocido"}`)}finally{w(!1)}},[ae,$,r,o,O,p,c,d,v,T,N,b]),Le=f.useCallback(async()=>{await K(),setTimeout(()=>{R()},2e3)},[K,R]),ie=()=>{h?A():R()},de=!h&&!ne&&o.length>0&&!!r.questionCompilerAgentId&&r.responseAgentIds.length>0&&(r.directAgentsIds.length===0||!!r.selectedPromptId);return e.jsxs("div",{className:"min-h-screen pb-20",style:{backgroundColor:"var(--color-background)"},children:[e.jsx(Pe,{title:"Multi-OCR Workflow",description:"Procesamiento avanzado con Mathpix OCR y envío directo a agentes en paralelo",icon:"⚡"}),!1,e.jsxs("div",{className:"",children:[e.jsx(qe,{imagesCount:o.length,maxImages:r.maxImages,isRunning:h,canRunWorkflow:de,onTakePhoto:g=>J([g]),onRunWorkflow:Le,onReset:ie}),e.jsx(Fe,{onImagesCapture:J,maxFiles:r.maxImages,currentFileCount:o.length,isProcessing:h,disabled:h,onWorkflowReset:R}),e.jsx(He,{responseAgentsResults:j,directAgentsResults:m}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Configuración del Workflow"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(_,{label:"Agente Compilador de Preguntas",selectedAgentId:r.questionCompilerAgentId,onAgentSelect:we,placeholder:"Selecciona el agente compilador...",helpText:"Este agente procesará el texto OCR compilado y generará una pregunta.",required:!0,disabled:h}),e.jsx(_,{label:"Agentes de Respuesta",selectedAgentId:"",selectedAgentIds:r.responseAgentIds,onAgentsSelect:Ce,multiple:!0,helpText:"Estos agentes procesarán la respuesta del agente compilador en paralelo.",required:!0,disabled:h})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:"Text-to-Speech (TTS)"}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-text-secondary)"},children:"Leer automáticamente las respuestas de los agentes cuando terminen de procesar"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.enableTTS,onChange:g=>ke(g.target.checked),disabled:h,className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:"Habilitar TTS"})]})]}),r.enableTTS&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-500 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"💡 Información sobre TTS:"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsx("li",{children:"• Las respuestas se leerán automáticamente cuando cada agente termine"}),e.jsx("li",{children:"• Las lecturas se ejecutan en secuencia (una después de la otra)"}),e.jsx("li",{children:"• Se detecta automáticamente el idioma español si está disponible"}),e.jsx("li",{children:"• Puedes pausar/reanudar desde los controles de TTS"})]})]})]})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:"OCR Inmediato"}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-text-secondary)"},children:"Procesar OCR tan pronto como se carga o captura una imagen, sin esperar a ejecutar el workflow completo"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.immediateOCR,onChange:g=>Ee(g.target.checked),disabled:h,className:"w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 dark:focus:ring-green-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:"Habilitar OCR Inmediato"})]})]}),r.immediateOCR&&e.jsx("div",{className:"mt-3 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{className:"text-xs text-green-700 dark:text-green-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"⚡ Información sobre OCR Inmediato:"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsx("li",{children:"• Las imágenes se procesan con OCR tan pronto como se cargan"}),e.jsx("li",{children:"• La confianza se lee inmediatamente cuando está disponible"}),e.jsx("li",{children:"• Reduce el tiempo de espera para ver resultados OCR"}),e.jsx("li",{children:"• Puede aumentar el número de requests a Mathpix"})]})]})]})})]}),$.length>0&&D.length>0&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Workflow Directo a Agentes (Opcional)"}),e.jsx("p",{className:"text-sm mb-4",style:{color:"var(--color-text-secondary)"},children:"Envía las imágenes directamente a agentes seleccionados con un prompt específico, ejecutándose en paralelo con el workflow Mathpix OCR."}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(_,{label:"Agentes Directos",selectedAgentId:"",selectedAgentIds:r.directAgentsIds,onAgentsSelect:Se,multiple:!0,helpText:"Estos agentes recibirán las imágenes directamente con el prompt seleccionado.",disabled:h}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text-primary)"},children:"Prompt para Agentes Directos"}),e.jsxs("select",{value:r.selectedPromptId,onChange:g=>Te(g.target.value),disabled:h,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Selecciona un prompt..."}),D.map(g=>e.jsx("option",{value:g.id,children:g.name},g.id))]}),r.selectedPromptId&&e.jsx("div",{className:"mt-2 p-2 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Prompt seleccionado:"})," ",(le=D.find(g=>g.id===r.selectedPromptId))==null?void 0:le.content]})})]})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-2",children:ne?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L3.354 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"Configuración incompleta"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-green-700 dark:text-green-300",children:"Configuración completa"})]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["Máximo ",r.maxImages," imágenes"]}),e.jsx("button",{onClick:()=>{window.confirm("¿Estás seguro de que quieres borrar TODOS los resultados y empezar desde cero?")&&M()},className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-700 text-white rounded transition-colors duration-200",disabled:h,children:"Borrar Todo"})]})]})]}),e.jsx(De,{onFilesSelect:J,maxFiles:r.maxImages,currentFileCount:o.length,isProcessing:h,disabled:h}),o.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:["Imágenes Seleccionadas (",o.length,")"]}),e.jsx("button",{onClick:l,disabled:h,className:"px-3 py-1 text-sm bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded-md transition-colors duration-200",children:"Limpiar Todo"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map((g,E)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:["#",E+1]}),e.jsx("button",{onClick:()=>x(g.id),disabled:h,className:"text-red-600 hover:text-red-700 disabled:text-gray-400",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 truncate mb-1",children:g.name}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(g.size/1024/1024).toFixed(2)," MB"]})]},g.id))})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:K,disabled:!de,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200 flex items-center justify-center",children:h?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Ejecutando Workflow..."]}):"Ejecutar Workflow"}),e.jsx("button",{onClick:ie,disabled:h,className:"px-6 py-3 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200",children:"Reiniciar"})]}),e.jsx(Be,{images:o,workflowSteps:i,compiledOCRText:k,questionCompilerResult:S,responseAgentsResults:j,directAgentsResults:m,isRunning:h,enableTTS:r.enableTTS,onSpeakAgentResult:H,onSpeakConfidenceInfo:pe,onSpeakConfidenceImmediate:Q,onStopTTS:fe,onPauseTTS:ye,onResumeTTS:je,onClearTTSQueue:ve,getTTSStatus:be}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-blue-800 dark:text-blue-200 mb-3",children:"¿Cómo funciona el Multi-OCR Workflow?"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-md font-medium text-blue-800 dark:text-blue-200 mb-3",children:"📄 Workflow Mathpix OCR"}),e.jsxs("div",{className:"space-y-3 text-sm text-blue-700 dark:text-blue-300",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"1"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Captura de Imágenes:"})," Sube archivos desde tu dispositivo o captura fotos con la cámara (hasta ",r.maxImages," imágenes)."]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"2"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Procesamiento OCR:"})," Las imágenes se procesan en paralelo con Mathpix OCR para extraer texto y fórmulas."]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"3"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Compilación:"}),' Los resultados OCR se compilan en un texto estructurado con formato "OCR #1 ',"{","texto","}",' FIN OCR #1".']})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"4"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Agente Compilador:"})," El texto compilado se envía al agente compilador que genera una pregunta o consulta procesada."]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Agentes de Respuesta:"})," La respuesta del compilador se envía en paralelo a múltiples agentes especializados."]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-md font-medium text-blue-800 dark:text-blue-200 mb-3",children:"🚀 Workflow Directo a Agentes (Opcional)"}),e.jsxs("div",{className:"space-y-3 text-sm text-blue-700 dark:text-blue-300",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-green-100 dark:bg-green-800 rounded-full flex items-center justify-center text-xs font-bold text-green-800 dark:text-green-200",children:"1"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Selección de Agentes:"})," Elige uno o más agentes que recibirán las imágenes directamente."]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-green-100 dark:bg-green-800 rounded-full flex items-center justify-center text-xs font-bold text-green-800 dark:text-green-200",children:"2"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Selección de Prompt:"})," Elige un prompt que se aplicará a todos los agentes seleccionados."]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-green-100 dark:bg-green-800 rounded-full flex items-center justify-center text-xs font-bold text-green-800 dark:text-green-200",children:"3"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Envío Directo:"})," Las imágenes se envían directamente a cada agente con el prompt seleccionado, ejecutándose en paralelo con el workflow Mathpix OCR."]})]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-100 dark:bg-blue-800/30 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-2",children:"💡 Consejos para mejores resultados:"}),e.jsxs("ul",{className:"text-xs text-blue-700 dark:text-blue-300 space-y-1",children:[e.jsx("li",{children:"• Usa la cámara para capturar pantallas de notebook con tu celular"}),e.jsx("li",{children:"• Configura la resolución y delay de enfoque en Configuración"}),e.jsx("li",{children:"• Asegúrate de que el texto sea legible y esté bien iluminado"}),e.jsx("li",{children:"• Puedes combinar archivos subidos con fotos capturadas"})]})]})]})]})]})});export{or as default,sr as meta};
