var J=Object.defineProperty;var G=(n,t,o)=>t in n?J(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o;var b=(n,t,o)=>G(n,typeof t!="symbol"?t+"":t,o);import{a,p as H}from"./chunk-B7RQU5TL-mf8dp6A9.js";import{createClient as Q}from"./index-DOzBNQ5J.js";class Y{constructor(){b(this,"config",null);b(this,"client",null);this.loadConfigFromLocalStorage()}loadConfigFromLocalStorage(){if(typeof window>"u"||typeof localStorage>"u")return;const t={supabaseUrl:localStorage.getItem("supabase.url")||"",supabaseAnonKey:localStorage.getItem("supabase.anonKey")||"",bucketName:localStorage.getItem("supabase.bucket")||"",basePath:localStorage.getItem("supabase.basePath")||""};this.isConfigValid(t)&&(this.config=t,this.client=Q(t.supabaseUrl,t.supabaseAnonKey))}isConfigValid(t){return t.supabaseUrl.trim().length>0&&t.supabaseAnonKey.trim().length>0&&t.bucketName.trim().length>0}isConfigured(){return this.config!==null&&this.isConfigValid(this.config)}async uploadPhotoAsync(t){if(!this.isConfigured())return{success:!1,error:"Supabase no está configurado. Ve a la página de configuración."};try{const o=new Date,i=C=>String(C).padStart(2,"0"),d=`${o.getFullYear()}${i(o.getMonth()+1)}${i(o.getDate())}-${i(o.getHours())}${i(o.getMinutes())}${i(o.getSeconds())}-${String(o.getMilliseconds()).padStart(3,"0")}`,f=(t.name.split(".").pop()||"").toLowerCase(),c=f&&f.length<=6?f:"jpg",S=(this.config.basePath||"").trim(),l=S?`${S}-${d}.${c}`:`${d}.${c}`,{error:h}=await this.client.storage.from(this.config.bucketName).upload(l,t,{cacheControl:"3600",upsert:!1,contentType:t.type||void 0});return h?{success:!1,error:`Error al subir: ${h.message}`}:{success:!0,path:l}}catch(o){return{success:!1,error:`Error: ${o instanceof Error?o.message:String(o)}`}}}async uploadMultiplePhotosAsync(t){const o=t.map(i=>this.uploadPhotoAsync(i));return Promise.all(o)}refreshConfig(){typeof window>"u"||typeof localStorage>"u"||this.loadConfigFromLocalStorage()}}const B=new Y,R={questionCompilerAgentId:"",responseAgentIds:[],maxImages:3,enableTTS:!1,directAgentsIds:[],selectedPromptId:""},x=a.createContext(void 0);function se({children:n}){const[t,o]=a.useState(R),[i,d]=a.useState(!0),[f,c]=a.useState([]),[S,l]=a.useState([]),[h,C]=a.useState(!1),[P,I]=a.useState(""),[E,k]=a.useState(null),[M,y]=a.useState({}),[W,A]=a.useState({});a.useEffect(()=>{try{const e=localStorage.getItem("multi-ocr-workflow-config");if(e){const s=JSON.parse(e);o(r=>({...R,...s}))}}catch(e){console.error("Error loading Multi-OCR Workflow config from localStorage:",e)}finally{d(!1)}},[]);const $=e=>{o(s=>({...s,...e}))},L=e=>{o(e);try{localStorage.setItem("multi-ocr-workflow-config",JSON.stringify(e))}catch(s){console.error("Error saving Multi-OCR Workflow config to localStorage:",s)}},T=()=>{o(R);try{localStorage.removeItem("multi-ocr-workflow-config")}catch(e){console.error("Error removing Multi-OCR Workflow config from localStorage:",e)}},F=e=>{const s=t.maxImages||3,r=f.length,u=Math.max(0,s-r),p=e.slice(0,u),z=p.map(g=>({id:Date.now().toString()+Math.random().toString(36).substr(2,9),file:g,name:g.name,size:g.size,status:"pending"}));c(g=>[...g,...z]),p.forEach(g=>{B.uploadPhotoAsync(g).then(m=>{m.success?console.log(`✓ Foto subida a Supabase: ${m.path}`):console.warn(`✗ Error al subir foto a Supabase: ${m.error}`)}).catch(m=>{console.error("✗ Error al subir foto a Supabase:",m)})})},D=e=>{c(s=>s.filter(r=>r.id!==e))},w=()=>{c([])},N=(e,s,r)=>{c(u=>u.map(p=>p.id===e?{...p,status:s,...r&&{ocrResult:r}}:p))},K=()=>{l([{id:"ocr-processing",name:"Procesamiento OCR de imágenes",status:"pending"},{id:"ocr-compilation",name:"Compilación de resultados OCR",status:"pending"},{id:"question-compiler",name:"Procesamiento con agente compilador",status:"pending"},{id:"response-agents",name:"Procesamiento con agentes de respuesta",status:"pending"}])},U=(e,s)=>{l(r=>r.map(u=>u.id===e?{...u,...s}:u))},j=(e,s)=>{y(r=>({...r,[e]:s}))},V=(e,s)=>{A(r=>({...r,[e]:s}))},O=()=>{I(""),k(null),y({}),A({})},_=()=>{C(!1),l(e=>e.map(s=>s.status==="processing"?{...s,status:"error",error:"Cancelado por el usuario"}:s))},v=()=>{w()},q={config:t,updateConfig:$,saveConfig:L,resetToDefaults:T,isLoading:i,images:f,addImages:F,removeImage:D,clearImages:w,updateImageStatus:N,workflowSteps:S,updateWorkflowStep:U,initializeWorkflowSteps:K,resetWorkflow:()=>{v()},compiledOCRText:P,setCompiledOCRText:I,questionCompilerResult:E,setQuestionCompilerResult:k,responseAgentsResults:M,setResponseAgentResult:j,directAgentsResults:W,setDirectAgentResult:V,clearResults:O,isRunning:h,setIsRunning:C,cancelWorkflow:_,resetImages:v,resetAll:()=>{l([]),w(),O()}};return H.jsx(x.Provider,{value:q,children:n})}function re(){const n=a.useContext(x);if(n===void 0)throw new Error("useMultiOCRWorkflow must be used within a MultiOCRWorkflowProvider");return n}export{se as M,B as s,re as u};
