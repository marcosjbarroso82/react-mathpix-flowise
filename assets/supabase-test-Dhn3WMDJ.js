const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DOzBNQ5J.js","assets/chunk-B7RQU5TL-mf8dp6A9.js","assets/preload-helper-BCbxkQLz.js"])))=>i.map(i=>d[i]);
import{_ as w}from"./preload-helper-BCbxkQLz.js";import{w as $,a as n,p as e}from"./chunk-B7RQU5TL-mf8dp6A9.js";const E=()=>[{title:"Prueba Supabase Storage"}],r={url:"supabase.url",anon:"supabase.anonKey",bucket:"supabase.bucket",basePath:"supabase.basePath"};function k(){return{supabaseUrl:localStorage.getItem(r.url)||"",supabaseAnonKey:localStorage.getItem(r.anon)||"",bucketName:localStorage.getItem(r.bucket)||"",basePath:localStorage.getItem(r.basePath)||""}}function A(c){localStorage.setItem(r.url,c.supabaseUrl.trim()),localStorage.setItem(r.anon,c.supabaseAnonKey.trim()),localStorage.setItem(r.bucket,c.bucketName.trim()),localStorage.setItem(r.basePath,(c.basePath||"").trim())}const _=$(function(){const[a,i]=n.useState(()=>k()),[x,s]=n.useState(""),[N,f]=n.useState(!1),m=n.useMemo(()=>a.supabaseUrl.trim().length>0&&a.supabaseAnonKey.trim().length>0&&a.bucketName.trim().length>0,[a]),P=n.useCallback(()=>{A(a),s("Configuración guardada en este dispositivo.")},[a]),I=n.useCallback(async t=>{var h;const o=(h=t.target.files)==null?void 0:h[0];if(o){if(!m){s("Faltan datos de configuración (URL, anon key o bucket).");return}try{f(!0),s("Subiendo imagen...");const{createClient:u}=await w(async()=>{const{createClient:g}=await import("./index-DOzBNQ5J.js");return{createClient:g}},__vite__mapDeps([0,1,2])),b=u(a.supabaseUrl.trim(),a.supabaseAnonKey.trim()),l=new Date,d=g=>String(g).padStart(2,"0"),v=`${l.getFullYear()}${d(l.getMonth()+1)}${d(l.getDate())}-${d(l.getHours())}${d(l.getMinutes())}${d(l.getSeconds())}-${String(l.getMilliseconds()).padStart(3,"0")}`,p=(o.name.split(".").pop()||"").toLowerCase(),y=p&&p.length<=6?p:"jpg",C=(a.basePath||"").trim(),S=C?`${C}-${v}.${y}`:`${v}.${y}`,{error:j}=await b.storage.from(a.bucketName.trim()).upload(S,o,{cacheControl:"3600",upsert:!1,contentType:o.type||void 0});if(j){s(`Error al subir: ${j.message}`);return}s(`Subida exitosa: ${S}`)}catch(u){const b=u instanceof Error?u.message:String(u);s(`Error: ${b}`)}finally{f(!1)}}},[a,m]);return e.jsxs("main",{className:"pt-16 p-4 container mx-auto",children:[e.jsx("h1",{className:"text-xl font-semibold mb-4",style:{color:"var(--color-text)"},children:"Prueba de subida a Supabase Storage"}),e.jsxs("section",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"Configuración"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",placeholder:"Supabase URL",value:a.supabaseUrl,onChange:t=>i(o=>({...o,supabaseUrl:t.target.value})),className:"w-full p-2 rounded border",style:{backgroundColor:"var(--color-surface)",borderColor:"var(--color-border)",color:"var(--color-text)"},autoComplete:"off"}),e.jsx("input",{type:"password",placeholder:"Anon public API key",value:a.supabaseAnonKey,onChange:t=>i(o=>({...o,supabaseAnonKey:t.target.value})),className:"w-full p-2 rounded border",style:{backgroundColor:"var(--color-surface)",borderColor:"var(--color-border)",color:"var(--color-text)"},autoComplete:"off"}),e.jsx("input",{type:"text",placeholder:"Bucket name (privado)",value:a.bucketName,onChange:t=>i(o=>({...o,bucketName:t.target.value})),className:"w-full p-2 rounded border",style:{backgroundColor:"var(--color-surface)",borderColor:"var(--color-border)",color:"var(--color-text)"},autoComplete:"off"}),e.jsx("input",{type:"text",placeholder:"Prefijo base (opcional, sin subcarpetas)",value:a.basePath||"",onChange:t=>i(o=>({...o,basePath:t.target.value})),className:"w-full p-2 rounded border",style:{backgroundColor:"var(--color-surface)",borderColor:"var(--color-border)",color:"var(--color-text)"},autoComplete:"off"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:P,className:"px-4 py-2 rounded font-medium",style:{backgroundColor:"var(--color-accent)",color:"white"},children:"Guardar configuración"}),e.jsx("button",{onClick:()=>{const t=k();i(t),s("Configuración cargada desde este dispositivo.")},className:"px-4 py-2 rounded font-medium border",style:{backgroundColor:"var(--color-surface)",color:"var(--color-text)",borderColor:"var(--color-border)"},children:"Cargar configuración"}),e.jsx("button",{onClick:()=>{localStorage.removeItem(r.url),localStorage.removeItem(r.anon),localStorage.removeItem(r.bucket),localStorage.removeItem(r.basePath),s("Configuración eliminada de este dispositivo.")},className:"px-4 py-2 rounded font-medium border",style:{backgroundColor:"var(--color-surface)",color:"var(--color-text)",borderColor:"var(--color-border)"},children:"Borrar configuración local"})]})]})]}),e.jsxs("section",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"Subir imagen"}),e.jsx("input",{type:"file",accept:"image/*",onChange:I,disabled:!m||N,className:"w-full"}),e.jsx("p",{className:"mt-2 text-sm",style:{color:"var(--color-text-secondary)"},children:"Se permite una sola imagen por intento. Se usará un nombre basado en timestamp, sin subcarpetas."})]}),e.jsxs("section",{className:"mb-6",children:[e.jsx("h3",{className:"text-base font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"¿Cómo obtener y configurar los datos?"}),e.jsxs("ul",{className:"list-disc ml-5 space-y-1",style:{color:"var(--color-text-tertiary)"},children:[e.jsxs("li",{children:["Supabase URL y Anon key: en tu proyecto de Supabase, ve a ",e.jsx("em",{children:"Settings → API"})," y copia ",e.jsx("em",{children:"Project URL"})," y ",e.jsx("em",{children:"anon public API key"}),"."]}),e.jsxs("li",{children:["Bucket privado: en ",e.jsx("em",{children:"Storage → New bucket"}),", crea o selecciona tu bucket privado."]}),e.jsxs("li",{children:["Prefijo base (opcional): texto simple para anteponer al nombre (p. ej. ",e.jsx("code",{children:"personal"}),'), sin usar "/" ni subcarpetas.']}),e.jsx("li",{children:"Políticas: si el bucket es privado, podrás verificar subidas en el dashboard. No se generan URLs públicas desde esta página."})]})]}),x&&e.jsx("div",{className:"mt-4 p-3 rounded border",style:{backgroundColor:"var(--color-surface)",borderColor:"var(--color-border)",color:"var(--color-text)"},children:x})]})});export{_ as default,E as meta};
