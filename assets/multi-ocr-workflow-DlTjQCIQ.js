var ie=Object.defineProperty;var de=(c,t,o)=>t in c?ie(c,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[t]=o;var R=(c,t,o)=>de(c,typeof t!="symbol"?t+"":t,o);import{a as f,p as e,w as le}from"./chunk-B7RQU5TL-xj-QjgGV.js";import{u as ce}from"./MultiOCRWorkflowContext-FrJXUmnB.js";import{u as F}from"./FlowiseAgentsContext-DaThIt2D.js";import{u as ue}from"./MathpixSettingsContext-C5kfmVKl.js";import{M as U}from"./mathpixService-BVSjE40i.js";import{W as J}from"./react-webcam-Cv0vQhem.js";import{u as G}from"./CameraSettingsContext-BDn7_6_x.js";import{u as K}from"./UIContext-ou41-CYt.js";import{P as me}from"./PageHeader-Bi621ECd.js";class P{static async processWorkflow(t,o,s,n,r){var i,u,m,l,d,j,p,C,y,v,h,a,b,x,g;try{(i=r==null?void 0:r.onStepStart)==null||i.call(r,"ocr-processing"),(u=r==null?void 0:r.onProgress)==null||u.call(r,1,4,"Procesando OCR de imágenes...");const N=await this.processImagesOCR(t,n,r);if(N.some(A=>A.error)){const A="Error en procesamiento OCR de algunas imágenes";throw(m=r==null?void 0:r.onStepError)==null||m.call(r,"ocr-processing",A),new Error(A)}(l=r==null?void 0:r.onStepComplete)==null||l.call(r,"ocr-processing",N),(d=r==null?void 0:r.onStepStart)==null||d.call(r,"ocr-compilation"),(j=r==null?void 0:r.onProgress)==null||j.call(r,2,4,"Compilando resultados OCR...");const k=this.compileOCRResults(N);(p=r==null?void 0:r.onStepComplete)==null||p.call(r,"ocr-compilation",{compiledText:k}),(C=r==null?void 0:r.onStepStart)==null||C.call(r,"question-compiler"),(y=r==null?void 0:r.onProgress)==null||y.call(r,3,4,"Procesando con agente compilador...");const E=await this.callFlowiseAgent(o,k);if(E.error)throw(v=r==null?void 0:r.onStepError)==null||v.call(r,"question-compiler",E.error),new Error(`Error en agente compilador: ${E.error}`);(h=r==null?void 0:r.onStepComplete)==null||h.call(r,"question-compiler",E),(a=r==null?void 0:r.onStepStart)==null||a.call(r,"response-agents"),(b=r==null?void 0:r.onProgress)==null||b.call(r,4,4,"Procesando con agentes de respuesta...");const W=await this.processResponseAgents(s,E.data,r);return Object.values(W).some(A=>A.error)&&((x=r==null?void 0:r.onStepError)==null||x.call(r,"response-agents","Error en algunos agentes de respuesta")),(g=r==null?void 0:r.onStepComplete)==null||g.call(r,"response-agents",W),{compiledOCRText:k,questionCompilerResult:E,responseAgentsResults:W,success:!0}}catch(N){return console.error("Error in MultiOCR Workflow:",N),{compiledOCRText:"",questionCompilerResult:null,responseAgentsResults:{},success:!1,error:N instanceof Error?N.message:"Error desconocido"}}}static async processImagesOCR(t,o,s){const n=t.map(async r=>{var i,u,m,l;try{(i=s==null?void 0:s.onImageOCRStart)==null||i.call(s,r.id);const d=await U.processImage(r.file,o);return d.error?((u=s==null?void 0:s.onImageOCRError)==null||u.call(s,r.id,d.error),{imageId:r.id,result:null,error:d.error}):((m=s==null?void 0:s.onImageOCRComplete)==null||m.call(s,r.id,d),{imageId:r.id,result:d})}catch(d){const j=d instanceof Error?d.message:"Error desconocido";return(l=s==null?void 0:s.onImageOCRError)==null||l.call(s,r.id,j),{imageId:r.id,result:null,error:j}}});return Promise.all(n)}static compileOCRResults(t){let o="";return t.forEach((s,n)=>{if(s.result&&!s.error){const r=n+1;let i="";s.result.data&&(typeof s.result.data=="string"?i=s.result.data:s.result.data.text?i=s.result.data.text:s.result.data.latex?i=s.result.data.latex:i=JSON.stringify(s.result.data)),o+=`OCR #${r} ${i} FIN OCR #${r}

`}}),o.trim()}static async callFlowiseAgent(t,o){try{const s=await fetch(t.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:o.trim()})});if(!s.ok)throw new Error(`Error ${s.status}: ${s.statusText}`);return{data:await s.json()}}catch(s){return{data:null,error:s instanceof Error?s.message:"Error desconocido"}}}static async processResponseAgents(t,o,s){let n="";typeof o=="string"?n=o:o!=null&&o.text?n=o.text:n=JSON.stringify(o);const r=t.map(async m=>{try{const l=await this.callFlowiseAgent(m,n);return{agentId:m.id,result:l}}catch(l){return{agentId:m.id,result:{data:null,error:l instanceof Error?l.message:"Error desconocido"}}}}),i=await Promise.all(r),u={};return i.forEach(({agentId:m,result:l})=>{u[m]=l}),u}static formatOCRResult(t){return!t||!t.data?"Sin resultado":typeof t.data=="string"?t.data:t.data.text?t.data.text:t.data.latex?t.data.latex:JSON.stringify(t.data,null,2)}static formatAgentResult(t){var o;if(!t)return"Sin resultado";if(t.error)return`Error: ${t.error}`;if(t.data){if(t.data.lectura)return console.log("TTS: Encontrado campo lectura en data.lectura:",t.data.lectura),t.data.lectura;if(typeof t.data=="string")return t.data;if(typeof t.data=="object"){const s=r=>{if(r.lectura&&typeof r.lectura=="string")return r.lectura;for(const i in r)if(typeof r[i]=="object"&&r[i]!==null){const u=s(r[i]);if(u)return u}return null},n=s(t.data);if(n)return console.log("TTS: Encontrado campo lectura recursivamente:",n),n}}return t.lectura&&typeof t.lectura=="string"?(console.log("TTS: Encontrado campo lectura en nivel raíz:",t.lectura),t.lectura):(o=t.data)!=null&&o.text?t.data.text:(console.log("TTS: No se encontró campo lectura, devolviendo JSON completo:",t.data),JSON.stringify(t.data,null,2))}}class xe{constructor(){R(this,"queue",[]);R(this,"isPlaying",!1);R(this,"currentUtterance",null);R(this,"isEnabled",!1);"speechSynthesis"in window||console.warn("Speech synthesis no está soportado en este navegador")}setEnabled(t){this.isEnabled=t,t||this.stop()}addToQueue(t){if(!this.isEnabled)return;const o={...t,id:`tts-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};this.queue.push(o),console.log(`TTS: Agregado a la cola - ${o.agentName}`,o.text.substring(0,100)+"..."),this.isPlaying||this.processQueue()}async processQueue(){var o,s;if(this.queue.length===0||this.isPlaying)return;const t=this.queue.shift();if(t){this.isPlaying=!0,console.log(`TTS: Iniciando lectura - ${t.agentName}`);try{await this.speak(t)}catch(n){console.error("TTS: Error en la lectura:",n),(o=t.onError)==null||o.call(t,n)}finally{this.isPlaying=!1,(s=t.onEnd)==null||s.call(t),setTimeout(()=>this.processQueue(),100)}}}speak(t){return new Promise((o,s)=>{if(!("speechSynthesis"in window)){s(new Error("Speech synthesis no está soportado"));return}speechSynthesis.cancel();const n=new SpeechSynthesisUtterance(t.text);this.currentUtterance=n;const i=speechSynthesis.getVoices().find(u=>u.lang.startsWith("es")||u.name.toLowerCase().includes("spanish")||u.name.toLowerCase().includes("español"));i&&(n.voice=i),n.rate=.9,n.pitch=1,n.volume=.8,n.onstart=()=>{var u;console.log(`TTS: Reproduciendo - ${t.agentName}`),(u=t.onStart)==null||u.call(t)},n.onend=()=>{console.log(`TTS: Completado - ${t.agentName}`),this.currentUtterance=null,o()},n.onerror=u=>{console.error("TTS: Error en utterance:",u),this.currentUtterance=null,s(new Error(`Error de speech synthesis: ${u.error}`))},speechSynthesis.speak(n)})}stop(){speechSynthesis.cancel(),this.queue=[],this.isPlaying=!1,this.currentUtterance=null,console.log("TTS: Detenido y cola limpiada")}pause(){this.isPlaying&&speechSynthesis.pause()}resume(){this.isPlaying&&speechSynthesis.resume()}getStatus(){return{isEnabled:this.isEnabled,isPlaying:this.isPlaying,queueLength:this.queue.length,currentItem:this.queue[0]||null}}clearQueue(){this.queue=[],console.log("TTS: Cola limpiada")}reset(){speechSynthesis.cancel(),this.queue=[],this.isPlaying=!1,this.currentUtterance=null,console.log("TTS: Estado completamente reseteado")}}const L=new xe;function he({enabled:c,responseAgentsResults:t,agents:o,isRunning:s=!1}){const n=f.useRef({}),r=f.useRef(new Set);f.useEffect(()=>{L.setEnabled(c)},[c]),f.useEffect(()=>{s&&(r.current.clear(),n.current={},L.reset(),console.log("TTS: Estados reseteados para nuevo workflow"))},[s]),f.useEffect(()=>{c&&(Object.entries(t).forEach(([p,C])=>{const y=n.current[p],v=!y||JSON.stringify(y)!==JSON.stringify(C),h=C==null?void 0:C.error,a=!r.current.has(p);if(v&&!h&&a){const b=o.find(N=>N.id===p),x=b?b.name:`Agente ${p}`,g=P.formatAgentResult(C);g&&g!=="Sin resultado"&&(console.log(`TTS: Agregando resultado de ${x} a la cola`),L.addToQueue({text:g,agentName:x,onStart:()=>{console.log(`TTS: Iniciando lectura de ${x}`)},onEnd:()=>{console.log(`TTS: Completada lectura de ${x}`),r.current.add(p)},onError:N=>{console.error(`TTS: Error leyendo ${x}:`,N),r.current.add(p)}}))}}),n.current={...t})},[t,o,c]),f.useEffect(()=>{c||(r.current.clear(),n.current={},L.reset())},[c]),f.useEffect(()=>{Object.keys(t).length===0&&(r.current.clear(),n.current={})},[t]);const i=f.useCallback((p,C)=>{if(!c)return;const y=o.find(a=>a.id===p),v=y?y.name:`Agente ${p}`,h=P.formatAgentResult(C);h&&h!=="Sin resultado"&&L.addToQueue({text:h,agentName:v,onStart:()=>console.log(`TTS: Lectura manual iniciada - ${v}`),onEnd:()=>console.log(`TTS: Lectura manual completada - ${v}`),onError:a=>console.error(`TTS: Error en lectura manual - ${v}:`,a)})},[c,o]),u=f.useCallback(()=>{L.stop(),r.current.clear()},[]),m=f.useCallback(()=>{L.pause()},[]),l=f.useCallback(()=>{L.resume()},[]),d=f.useCallback(()=>{L.clearQueue()},[]),j=f.useCallback(()=>L.getStatus(),[]);return{speakAgentResult:i,stopTTS:u,pauseTTS:m,resumeTTS:l,clearTTSQueue:d,getTTSStatus:j}}function ge({onFilesSelect:c,maxFiles:t,currentFileCount:o,isProcessing:s,disabled:n=!1}){const r=f.useRef(null),[i,u]=f.useState(!1),m=Math.max(0,t-o),l=m>0&&!n&&!s,d=f.useCallback(x=>{const g=Array.from(x),N=[],$=[];if(g.forEach(k=>{const E=U.validateImageFile(k);E.valid?N.push(k):$.push(`${k.name}: ${E.error}`)}),$.length>0&&alert(`Algunos archivos no son válidos:
${$.join(`
`)}`),N.length>0){const k=N.slice(0,m);c(k),k.length<N.length&&alert(`Se seleccionaron ${k.length} de ${N.length} archivos válidos debido al límite de ${t} imágenes.`)}},[c,m,t]),j=f.useCallback(x=>{x.target.files&&x.target.files.length>0&&d(x.target.files),x.target.value=""},[d]),p=f.useCallback(x=>{if(x.preventDefault(),x.stopPropagation(),u(!1),!l)return;const g=x.dataTransfer.files;g&&g.length>0&&d(g)},[d,l]),C=f.useCallback(x=>{x.preventDefault(),x.stopPropagation()},[]),y=f.useCallback(x=>{x.preventDefault(),x.stopPropagation(),l&&u(!0)},[l]),v=f.useCallback(x=>{x.preventDefault(),x.stopPropagation(),u(!1)},[]),h=f.useCallback(()=>{l&&r.current&&r.current.click()},[l]),a=()=>s?"Procesando...":n?"Deshabilitado":m===0?`Máximo ${t} imágenes alcanzado`:`Selecciona hasta ${m} imagen${m!==1?"es":""} más`,b=()=>s?"text-blue-600":n||m===0?"text-gray-500":"text-gray-700";return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:"Subir Múltiples Imágenes"}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[o,"/",t," imágenes"]})]}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-all duration-200 ${l?i?"border-blue-500 dark:border-blue-400 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 cursor-pointer":"border-gray-300 dark:border-gray-600 cursor-not-allowed opacity-50"}`,onDrop:p,onDragOver:C,onDragEnter:y,onDragLeave:v,onClick:h,children:[e.jsx("div",{className:`w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center ${l?"bg-blue-100 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700"}`,children:e.jsx("svg",{className:`w-8 h-8 ${l?"text-blue-600 dark:text-blue-400":"text-gray-400"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 12l3 3m0 0l3-3m-3 3V9"})})}),e.jsx("p",{className:"text-lg font-medium mb-2",style:{color:l?"var(--color-text-primary)":"var(--color-text-secondary)"},children:i?"Suelta las imágenes aquí":"Arrastra imágenes aquí o haz clic para seleccionar"}),e.jsx("p",{className:`text-sm mb-4 ${b()}`,children:a()}),e.jsx("p",{className:"text-xs mb-4",style:{color:"var(--color-text-secondary)"},children:"Soporta JPG, PNG, GIF, BMP, WebP y PDF (máximo 10MB por archivo)"}),e.jsx("button",{className:`px-6 py-2 rounded-lg transition-colors duration-200 ${l?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,disabled:!l,type:"button",children:s?"Procesando...":"Seleccionar Archivos"})]}),o>0&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-sm text-green-800 dark:text-green-200 font-medium",children:[o," imagen",o!==1?"es":""," seleccionada",o!==1?"s":""]})]})}),e.jsx("input",{ref:r,type:"file",accept:"image/*,.pdf",multiple:!0,onChange:j,className:"hidden",disabled:!l})]})}function pe({onImagesCapture:c,maxFiles:t,currentFileCount:o,isProcessing:s,disabled:n=!1}){const r=f.useRef(null),[i,u]=f.useState(null),[m,l]=f.useState(!1),[d,j]=f.useState([]),{settings:p}=G(),C={width:p.videoConstraints.width,height:p.videoConstraints.height,facingMode:p.videoConstraints.facingMode},y=Math.max(0,t-o),v=y>0&&!n&&!s&&!m,h=f.useCallback(async()=>{if(!(!r.current||!v)){l(!0),u(null);try{await new Promise(N=>setTimeout(N,p.focusDelay*1e3));const g=r.current.getScreenshot({width:p.videoConstraints.width,height:p.videoConstraints.height});if(g){const $=await(await fetch(g)).blob(),k=new File([$],`camera-capture-${Date.now()}.${p.screenshotFormat.split("/")[1]}`,{type:p.screenshotFormat}),E=[...d,k];j(E),E.length>=y&&(c(E),j([]))}}catch(g){u("Error al capturar la imagen"),console.error("Error capturing image:",g)}finally{l(!1)}}},[p,v,d,y,c]),a=f.useCallback(()=>{d.length>0&&(c(d),j([]))},[d,c]),b=f.useCallback(()=>{j([])},[]),x=n||s||m;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:"Capturar con Cámara"}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[o+d.length,"/",t," imágenes"]})]}),i&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-200 rounded-md",children:i}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{ref:r,audio:!1,videoConstraints:C,className:`w-full h-auto rounded-lg ${x?"opacity-50":""}`,style:{maxHeight:"60vh"},onUserMediaError:g=>{u("Error al acceder a la cámara. Verifica los permisos."),console.error("Webcam error:",g)}}),(m||s)&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"text-white text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-2"}),e.jsx("p",{children:m?"Enfocando...":"Procesando..."})]})})]}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:h,disabled:!v,className:`flex-1 px-6 py-3 rounded-lg font-medium transition-colors duration-200 ${v?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,children:m?"Enfocando...":s?"Procesando...":"Capturar Foto"}),d.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:a,disabled:s,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200",children:["Procesar ",d.length," foto",d.length!==1?"s":""]}),e.jsx("button",{onClick:b,disabled:s,className:"px-4 py-3 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200",children:"Limpiar"})]})]}),d.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L3.354 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:[d.length," foto",d.length!==1?"s":""," capturada",d.length!==1?"s":""," pendiente",d.length!==1?"s":""," de procesar"]})]}),e.jsx("div",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:'Haz clic en "Procesar" para agregar a la lista de imágenes o "Capturar Foto" para tomar más.'})]}),e.jsx("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("div",{children:["Resolución: ",p.videoConstraints.width,"x",p.videoConstraints.height]}),e.jsxs("div",{children:["Cámara: ",p.videoConstraints.facingMode==="environment"?"Trasera":"Frontal"]}),e.jsxs("div",{children:["Formato: ",p.screenshotFormat]}),e.jsxs("div",{children:["Calidad: ",p.screenshotQuality]}),e.jsxs("div",{children:["Delay: ",p.focusDelay,"s"]})]})})]})}function Q({label:c,selectedAgentId:t,selectedAgentIds:o=[],onAgentSelect:s,onAgentsSelect:n,multiple:r=!1,disabled:i=!1,placeholder:u="Selecciona un agente...",helpText:m,required:l=!1}){var v;const{agents:d,isLoading:j}=F(),p=h=>{s&&s(h)},C=(h,a)=>{n&&n(a?[...o,h]:o.filter(b=>b!==h))},y=()=>{var h;return r?o.map(a=>{var b;return(b=d.find(x=>x.id===a))==null?void 0:b.name}).filter(Boolean).join(", "):((h=d.find(a=>a.id===t))==null?void 0:h.name)||""};return j?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--color-text-primary)"},children:[c," ",l&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700",children:e.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Cargando agentes..."})})]}):d.length===0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--color-text-primary)"},children:[c," ",l&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700",children:e.jsx("span",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"No hay agentes configurados"})}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Ve a Configuración para agregar agentes de Flowise"})]}):r?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--color-text-primary)"},children:[c," ",l&&e.jsx("span",{className:"text-red-500",children:"*"})]}),o.length>0&&e.jsxs("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:[e.jsxs("div",{className:"text-xs text-blue-800 dark:text-blue-200 font-medium mb-1",children:[o.length," agente",o.length!==1?"s":""," seleccionado",o.length!==1?"s":"",":"]}),e.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:y()})]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-2",children:d.map(h=>{const a=o.includes(h.id);return e.jsxs("label",{className:`flex items-start space-x-3 p-2 rounded cursor-pointer transition-colors ${i?"opacity-50 cursor-not-allowed":"hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsx("input",{type:"checkbox",checked:a,onChange:b=>C(h.id,b.target.checked),disabled:i,className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:h.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:h.url})]})]},h.id)})}),m&&e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:m})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--color-text-primary)"},children:[c," ",l&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:t,onChange:h=>p(h.target.value),disabled:i,className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white ${i?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"",children:u}),d.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))]}),t&&e.jsxs("div",{className:"p-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md",children:[e.jsx("div",{className:"text-xs text-green-800 dark:text-green-200 font-medium",children:"Agente seleccionado:"}),e.jsx("div",{className:"text-xs text-green-700 dark:text-green-300",children:y()}),e.jsx("div",{className:"text-xs text-green-600 dark:text-green-400 truncate mt-1",children:(v=d.find(h=>h.id===t))==null?void 0:v.url})]}),m&&e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:m})]})}function fe({images:c,workflowSteps:t,compiledOCRText:o,questionCompilerResult:s,responseAgentsResults:n,isRunning:r,enableTTS:i=!1,onSpeakAgentResult:u,onStopTTS:m,onPauseTTS:l,onResumeTTS:d,onClearTTSQueue:j,getTTSStatus:p}){const{agents:C}=F(),y=a=>{switch(a){case"pending":return e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"⏳"})});case"processing":return e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center",children:e.jsxs("svg",{className:"w-4 h-4 text-blue-600 dark:text-blue-400 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})});case"completed":return e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})});case"error":return e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 dark:bg-red-900 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}},v=a=>{switch(a){case"pending":return"⏳";case"processing":return"🔄";case"completed":return"✅";case"error":return"❌"}},h=(a,b)=>a?`${(((b||new Date).getTime()-a.getTime())/1e3).toFixed(1)}s`:"";return e.jsxs("div",{className:"space-y-6",children:[c.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Estado de las Imágenes"}),e.jsx("div",{className:"space-y-3",children:c.map((a,b)=>{var x;return e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg",style:{backgroundColor:"var(--color-surface)"},children:[e.jsx("span",{className:"text-lg",children:v(a.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:["Imagen #",b+1,": ",a.name]}),e.jsxs("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[(a.size/1024/1024).toFixed(2)," MB"]})]}),a.status==="completed"&&a.ocrResult&&e.jsxs("div",{className:"mt-2 p-2 bg-green-50 dark:bg-green-900/20 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-green-800 dark:text-green-200 mb-1",children:"Resultado OCR:"}),e.jsx("div",{className:"text-green-700 dark:text-green-300 max-h-20 overflow-y-auto",children:P.formatOCRResult(a.ocrResult)})]}),a.status==="error"&&((x=a.ocrResult)==null?void 0:x.error)&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 dark:bg-red-900/20 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-red-800 dark:text-red-200 mb-1",children:"Error:"}),e.jsx("div",{className:"text-red-700 dark:text-red-300",children:a.ocrResult.error})]})]})]},a.id)})})]}),t.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Progreso del Workflow"}),e.jsx("div",{className:"space-y-4",children:t.map((a,b)=>e.jsxs("div",{className:"flex items-start space-x-4",children:[y(a.status),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:a.name}),a.startTime&&e.jsx("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:h(a.startTime,a.endTime)})]}),a.status==="error"&&a.error&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",children:[e.jsx("div",{className:"text-sm text-red-800 dark:text-red-200 font-medium",children:"Error:"}),e.jsx("div",{className:"text-sm text-red-700 dark:text-red-300",children:a.error})]}),a.status==="completed"&&a.result&&e.jsx("div",{className:"mt-2 text-xs",style:{color:"var(--color-text-secondary)"},children:"✓ Completado exitosamente"})]}),b<t.length-1&&e.jsx("div",{className:"absolute left-4 top-8 w-px h-6 bg-gray-300 dark:bg-gray-600",style:{marginTop:"2rem"}})]},a.id))})]}),o&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Texto OCR Compilado"}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:e.jsx("pre",{className:"text-sm whitespace-pre-wrap overflow-x-auto",style:{color:"var(--color-text-primary)"},children:o})})]}),s&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Resultado del Agente Compilador"}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsx("pre",{className:"text-sm whitespace-pre-wrap overflow-x-auto text-blue-800 dark:text-blue-200",children:P.formatAgentResult(s)})})]}),Object.keys(n).length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:"Resultados de Agentes de Respuesta"}),i&&e.jsx("div",{className:"flex items-center space-x-2",children:p&&(()=>{const a=p();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.isPlaying?"Reproduciendo...":a.queueLength>0?`En cola: ${a.queueLength}`:"TTS listo"}),e.jsxs("div",{className:"flex space-x-1",children:[a.isPlaying?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:l,className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",title:"Pausar TTS",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("button",{onClick:d,className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",title:"Reanudar TTS",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h1m4 0h1m-6-8h8a2 2 0 012 2v8a2 2 0 01-2 2H8a2 2 0 01-2-2V6a2 2 0 012-2z"})})})]}):e.jsx("button",{onClick:l,className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",title:"Pausar TTS",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("button",{onClick:m,className:"p-1 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-200",title:"Detener TTS",children:e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 10h6v4H9z"})]})}),e.jsx("button",{onClick:j,className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",title:"Limpiar cola TTS",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})})()})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(n).map(([a,b])=>{const x=C.find(N=>N.id===a),g=x?x.name:`Agente ${a}`;return e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm font-medium text-purple-800 dark:text-purple-200",children:g}),i&&u&&e.jsx("button",{onClick:()=>u(a,b),className:"p-1 text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-200",title:"Leer respuesta con TTS",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 4.663 12 5.109 12 6v12c0 .891-1.077 1.337-1.707.707L5.586 15z"})})})]}),x&&e.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-400 mb-2 truncate",children:x.url}),e.jsx("pre",{className:"text-sm whitespace-pre-wrap overflow-x-auto text-purple-700 dark:text-purple-300",children:P.formatAgentResult(b)})]},a)})})]}),r&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"Ejecutando workflow..."})]})})]})}const D=()=>{try{const c=new(window.AudioContext||window.webkitAudioContext),t=c.createOscillator(),o=c.createGain();t.connect(o),o.connect(c.destination),t.frequency.setValueAtTime(800,c.currentTime),t.type="sine",o.gain.setValueAtTime(0,c.currentTime),o.gain.linearRampToValueAtTime(.1,c.currentTime+.01),o.gain.linearRampToValueAtTime(0,c.currentTime+.1),t.start(c.currentTime),t.stop(c.currentTime+.1)}catch(c){console.log("No se pudo reproducir el sonido:",c)}};function ye({imagesCount:c,maxImages:t,isRunning:o,canRunWorkflow:s,onTakePhoto:n,onRunWorkflow:r,onReset:i}){const{settings:u}=G(),{uiSettings:m}=K(),l=f.useRef(null),d=c<t&&!o,j=f.useCallback(async()=>{if(!(!d||!l.current)){D();try{await new Promise(v=>setTimeout(v,u.focusDelay*1e3));const y=l.current.getScreenshot({width:u.videoConstraints.width,height:u.videoConstraints.height});if(y){const h=await(await fetch(y)).blob(),a=new File([h],`camera-capture-${Date.now()}.${u.screenshotFormat.split("/")[1]}`,{type:u.screenshotFormat});n(a)}}catch(y){console.error("Error en captura automática:",y)}}},[u,d,n]),p=f.useCallback(()=>{s&&(D(),r())},[s,r]),C=f.useCallback(()=>{D(),i()},[i]);return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          @keyframes fastBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
          }
          .hover-fast-blink:hover {
            animation: fastBlink 0.3s infinite;
          }
        `}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-700 mb-6",children:[!m.compactMode&&e.jsx("h2",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"⚡ Atajos de Ejecución"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("button",{onClick:j,disabled:!d,className:`px-4 py-6 rounded-lg font-medium transition-all duration-100 flex items-center justify-center space-x-2 hover-fast-blink ${d?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,children:[e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:"Tomar Foto"})]}),e.jsxs("button",{onClick:p,disabled:!s,className:`px-4 py-6 rounded-lg font-medium transition-all duration-100 flex items-center justify-center space-x-2 hover-fast-blink ${s?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsx("span",{children:"Procesar y Limpiar"}),c>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-white/20 rounded-full text-xs font-bold",children:c})]})]}),e.jsxs("button",{onClick:C,className:"w-full px-4 py-6 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-all duration-100 flex items-center justify-center space-x-2 hover-fast-blink",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:o?"Cancelar Workflow":"Reiniciar"})]}),e.jsx("div",{className:"mt-3 text-xs",style:{color:"var(--color-text-secondary)"},children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Imágenes: ",c,"/",t]}),e.jsxs("span",{children:["Estado: ",o?"Ejecutando...":"Listo"]})]})}),e.jsx("div",{className:"hidden",children:e.jsx(J,{ref:l,audio:!1,videoConstraints:{width:u.videoConstraints.width,height:u.videoConstraints.height,facingMode:u.videoConstraints.facingMode},onUserMediaError:y=>{console.error("Webcam error:",y)}})})]})]})}function je({responseAgentsResults:c}){const{agents:t}=F(),{uiSettings:o}=K(),s=i=>{if(!i||i.error)return(i==null?void 0:i.error)||"Sin resultado";if(i.data){if(i.data.lectura)return i.data.lectura;if(typeof i.data=="string")return i.data;if(typeof i.data=="object"){const u=l=>{if(l.lectura&&typeof l.lectura=="string")return l.lectura;for(const d in l)if(typeof l[d]=="object"&&l[d]!==null){const j=u(l[d]);if(j)return j}return null},m=u(i.data);if(m)return m}}return i.lectura&&typeof i.lectura=="string"?i.lectura:'Campo "lectura" no encontrado en la respuesta'},n=Object.keys(c).length>0,r=Object.values(c).some(i=>i&&!i.error&&s(i)!=="Sin resultado");return!n||!r?null:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[!o.compactMode&&e.jsx("h2",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"📋 Resumen de Resultados"}),e.jsx("div",{className:"space-y-4",children:Object.entries(c).map(([i,u])=>{const m=t.find(j=>j.id===i),l=m?m.name:`Agente ${i}`,d=s(u);return!d||d==="Sin resultado"?null:e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:l}),e.jsx("div",{className:"text-xs text-green-600 dark:text-green-400",children:"Lectura"})]}),e.jsx("div",{className:"text-sm text-green-700 dark:text-green-300 whitespace-pre-wrap",children:d})]},i)})}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-xs text-blue-700 dark:text-blue-300",children:'Mostrando solo el campo "lectura" de las respuestas de los agentes'})]})})]})}function Me({}){return[{title:"Multi-OCR Workflow - Procesamiento Avanzado"},{name:"description",content:"Workflow avanzado para procesar múltiples imágenes con OCR y agentes de IA"}]}const Ae=le(function(){const{config:t,updateConfig:o,saveConfig:s,images:n,addImages:r,removeImage:i,clearImages:u,updateImageStatus:m,workflowSteps:l,updateWorkflowStep:d,initializeWorkflowSteps:j,resetWorkflow:p,compiledOCRText:C,setCompiledOCRText:y,questionCompilerResult:v,setQuestionCompilerResult:h,responseAgentsResults:a,setResponseAgentResult:b,clearResults:x,isRunning:g,setIsRunning:N,cancelWorkflow:$,resetImages:k,resetAll:E}=ce(),{agents:W}=F(),{settings:M}=ue(),{speakAgentResult:A,stopTTS:X,pauseTTS:Y,resumeTTS:Z,clearTTSQueue:_,getTTSStatus:ee}=he({enabled:t.enableTTS,responseAgentsResults:a,agents:W,isRunning:g}),[B,re]=f.useState(!1),te=w=>{const S={...t,questionCompilerAgentId:w};o(S),s(S)},se=w=>{const S={...t,responseAgentIds:w};o(S),s(S)},oe=w=>{const S={...t,enableTTS:w};o(S),s(S)},q=f.useCallback(()=>{const w=[];return(!M.appId||!M.appKey)&&w.push("Configuración de Mathpix incompleta"),t.questionCompilerAgentId||w.push("Agente compilador de preguntas no seleccionado"),t.responseAgentIds.length===0&&w.push("No hay agentes de respuesta seleccionados"),n.length===0&&w.push("No hay imágenes para procesar"),re(w.length>0),w},[M,t,n]),z=f.useCallback(async()=>{const w=q();if(w.length>0){alert(`No se puede ejecutar el workflow:
${w.join(`
`)}`);return}N(!0),x(),j();try{const S=W.find(T=>T.id===t.questionCompilerAgentId),ae=W.filter(T=>t.responseAgentIds.includes(T.id));if(!S)throw new Error("Agente compilador no encontrado");const I=await P.processWorkflow(n,S,ae,{appId:M.appId,appKey:M.appKey,includeMath:M.includeMath,outputFormats:M.outputFormats},{onImageOCRStart:T=>{m(T,"processing")},onImageOCRComplete:(T,O)=>{m(T,"completed",O)},onImageOCRError:(T,O)=>{m(T,"error",{status:0,data:null,error:O})},onStepStart:T=>{d(T,{status:"processing",startTime:new Date})},onStepComplete:(T,O)=>{d(T,{status:"completed",endTime:new Date,result:O})},onStepError:(T,O)=>{d(T,{status:"error",endTime:new Date,error:O})}});I.success?(y(I.compiledOCRText),h(I.questionCompilerResult),Object.entries(I.responseAgentsResults).forEach(([T,O])=>{b(T,O)})):alert(`Error en el workflow: ${I.error}`)}catch(S){console.error("Error executing workflow:",S),alert(`Error inesperado: ${S instanceof Error?S.message:"Error desconocido"}`)}finally{N(!1)}},[q,W,t,n,M,x,j,m,d,y,h,b]),ne=f.useCallback(async()=>{await z(),setTimeout(()=>{k()},2e3)},[z,k]),V=()=>{g?$():k()},H=!g&&!B&&n.length>0&&!!t.questionCompilerAgentId&&t.responseAgentIds.length>0;return e.jsxs("div",{className:"min-h-screen pb-20",style:{backgroundColor:"var(--color-background)"},children:[e.jsx(me,{title:"Multi-OCR Workflow",description:"Procesamiento avanzado con múltiples imágenes OCR y agentes de IA",icon:"⚡"}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx(ye,{imagesCount:n.length,maxImages:t.maxImages,isRunning:g,canRunWorkflow:H,onTakePhoto:w=>r([w]),onRunWorkflow:ne,onReset:V}),e.jsx(je,{responseAgentsResults:a}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Configuración del Workflow"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Q,{label:"Agente Compilador de Preguntas",selectedAgentId:t.questionCompilerAgentId,onAgentSelect:te,placeholder:"Selecciona el agente compilador...",helpText:"Este agente procesará el texto OCR compilado y generará una pregunta.",required:!0,disabled:g}),e.jsx(Q,{label:"Agentes de Respuesta",selectedAgentId:"",selectedAgentIds:t.responseAgentIds,onAgentsSelect:se,multiple:!0,helpText:"Estos agentes procesarán la respuesta del agente compilador en paralelo.",required:!0,disabled:g})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:"Text-to-Speech (TTS)"}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-text-secondary)"},children:"Leer automáticamente las respuestas de los agentes cuando terminen de procesar"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.enableTTS,onChange:w=>oe(w.target.checked),disabled:g,className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:"Habilitar TTS"})]})]}),t.enableTTS&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-500 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"💡 Información sobre TTS:"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsx("li",{children:"• Las respuestas se leerán automáticamente cuando cada agente termine"}),e.jsx("li",{children:"• Las lecturas se ejecutan en secuencia (una después de la otra)"}),e.jsx("li",{children:"• Se detecta automáticamente el idioma español si está disponible"}),e.jsx("li",{children:"• Puedes pausar/reanudar desde los controles de TTS"})]})]})]})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-2",children:B?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L3.354 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"Configuración incompleta"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-green-700 dark:text-green-300",children:"Configuración completa"})]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["Máximo ",t.maxImages," imágenes"]}),e.jsx("button",{onClick:()=>{window.confirm("¿Estás seguro de que quieres borrar TODOS los resultados y empezar desde cero?")&&E()},className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-700 text-white rounded transition-colors duration-200",disabled:g,children:"Borrar Todo"})]})]})]}),e.jsx(ge,{onFilesSelect:r,maxFiles:t.maxImages,currentFileCount:n.length,isProcessing:g,disabled:g}),e.jsx(pe,{onImagesCapture:r,maxFiles:t.maxImages,currentFileCount:n.length,isProcessing:g,disabled:g}),n.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:["Imágenes Seleccionadas (",n.length,")"]}),e.jsx("button",{onClick:u,disabled:g,className:"px-3 py-1 text-sm bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded-md transition-colors duration-200",children:"Limpiar Todo"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map((w,S)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:["#",S+1]}),e.jsx("button",{onClick:()=>i(w.id),disabled:g,className:"text-red-600 hover:text-red-700 disabled:text-gray-400",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 truncate mb-1",children:w.name}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(w.size/1024/1024).toFixed(2)," MB"]})]},w.id))})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:z,disabled:!H,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200 flex items-center justify-center",children:g?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Ejecutando Workflow..."]}):"Ejecutar Workflow"}),e.jsx("button",{onClick:V,disabled:g,className:"px-6 py-3 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200",children:"Reiniciar"})]}),e.jsx(fe,{images:n,workflowSteps:l,compiledOCRText:C,questionCompilerResult:v,responseAgentsResults:a,isRunning:g,enableTTS:t.enableTTS,onSpeakAgentResult:A,onStopTTS:X,onPauseTTS:Y,onResumeTTS:Z,onClearTTSQueue:_,getTTSStatus:ee}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-blue-800 dark:text-blue-200 mb-3",children:"¿Cómo funciona el Multi-OCR Workflow?"}),e.jsxs("div",{className:"space-y-3 text-sm text-blue-700 dark:text-blue-300",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"1"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Captura de Imágenes:"})," Sube archivos desde tu dispositivo o captura fotos con la cámara (hasta ",t.maxImages," imágenes)."]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"2"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Procesamiento OCR:"})," Las imágenes se procesan en paralelo con Mathpix OCR para extraer texto y fórmulas."]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"3"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Compilación:"}),' Los resultados OCR se compilan en un texto estructurado con formato "OCR #1 ',"{","texto","}",' FIN OCR #1".']})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"4"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Agente Compilador:"})," El texto compilado se envía al agente compilador que genera una pregunta o consulta procesada."]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Agentes de Respuesta:"})," La respuesta del compilador se envía en paralelo a múltiples agentes especializados."]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-100 dark:bg-blue-800/30 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-2",children:"💡 Consejos para mejores resultados:"}),e.jsxs("ul",{className:"text-xs text-blue-700 dark:text-blue-300 space-y-1",children:[e.jsx("li",{children:"• Usa la cámara para capturar pantallas de notebook con tu celular"}),e.jsx("li",{children:"• Configura la resolución y delay de enfoque en Configuración"}),e.jsx("li",{children:"• Asegúrate de que el texto sea legible y esté bien iluminado"}),e.jsx("li",{children:"• Puedes combinar archivos subidos con fotos capturadas"})]})]})]})]})]})});export{Ae as default,Me as meta};
