import{a as p,p as e,w as K}from"./chunk-B7RQU5TL-xj-QjgGV.js";import{u as Q}from"./MultiOCRWorkflowContext-CzcRHix3.js";import{u as P}from"./FlowiseAgentsContext-DaThIt2D.js";import{u as X}from"./MathpixSettingsContext-C5kfmVKl.js";import{M as H}from"./mathpixService-BVSjE40i.js";import{W as q}from"./react-webcam-Cv0vQhem.js";import{u as V}from"./CameraSettingsContext-BDn7_6_x.js";class W{static async processWorkflow(o,n,s,i,r){var x,c,l,a,t,h,d,C,b,k,m,S,E,g,u;try{(x=r==null?void 0:r.onStepStart)==null||x.call(r,"ocr-processing"),(c=r==null?void 0:r.onProgress)==null||c.call(r,1,4,"Procesando OCR de imágenes...");const v=await this.processImagesOCR(o,i,r);if(v.some(M=>M.error)){const M="Error en procesamiento OCR de algunas imágenes";throw(l=r==null?void 0:r.onStepError)==null||l.call(r,"ocr-processing",M),new Error(M)}(a=r==null?void 0:r.onStepComplete)==null||a.call(r,"ocr-processing",v),(t=r==null?void 0:r.onStepStart)==null||t.call(r,"ocr-compilation"),(h=r==null?void 0:r.onProgress)==null||h.call(r,2,4,"Compilando resultados OCR...");const w=this.compileOCRResults(v);(d=r==null?void 0:r.onStepComplete)==null||d.call(r,"ocr-compilation",{compiledText:w}),(C=r==null?void 0:r.onStepStart)==null||C.call(r,"question-compiler"),(b=r==null?void 0:r.onProgress)==null||b.call(r,3,4,"Procesando con agente compilador...");const f=await this.callFlowiseAgent(n,w);if(f.error)throw(k=r==null?void 0:r.onStepError)==null||k.call(r,"question-compiler",f.error),new Error(`Error en agente compilador: ${f.error}`);(m=r==null?void 0:r.onStepComplete)==null||m.call(r,"question-compiler",f),(S=r==null?void 0:r.onStepStart)==null||S.call(r,"response-agents"),(E=r==null?void 0:r.onProgress)==null||E.call(r,4,4,"Procesando con agentes de respuesta...");const I=await this.processResponseAgents(s,f.data,r);return Object.values(I).some(M=>M.error)&&((g=r==null?void 0:r.onStepError)==null||g.call(r,"response-agents","Error en algunos agentes de respuesta")),(u=r==null?void 0:r.onStepComplete)==null||u.call(r,"response-agents",I),{compiledOCRText:w,questionCompilerResult:f,responseAgentsResults:I,success:!0}}catch(v){return console.error("Error in MultiOCR Workflow:",v),{compiledOCRText:"",questionCompilerResult:null,responseAgentsResults:{},success:!1,error:v instanceof Error?v.message:"Error desconocido"}}}static async processImagesOCR(o,n,s){const i=o.map(async r=>{var x,c,l,a;try{(x=s==null?void 0:s.onImageOCRStart)==null||x.call(s,r.id);const t=await H.processImage(r.file,n);return t.error?((c=s==null?void 0:s.onImageOCRError)==null||c.call(s,r.id,t.error),{imageId:r.id,result:null,error:t.error}):((l=s==null?void 0:s.onImageOCRComplete)==null||l.call(s,r.id,t),{imageId:r.id,result:t})}catch(t){const h=t instanceof Error?t.message:"Error desconocido";return(a=s==null?void 0:s.onImageOCRError)==null||a.call(s,r.id,h),{imageId:r.id,result:null,error:h}}});return Promise.all(i)}static compileOCRResults(o){let n="";return o.forEach((s,i)=>{if(s.result&&!s.error){const r=i+1;let x="";s.result.data&&(typeof s.result.data=="string"?x=s.result.data:s.result.data.text?x=s.result.data.text:s.result.data.latex?x=s.result.data.latex:x=JSON.stringify(s.result.data)),n+=`OCR #${r} ${x} FIN OCR #${r}

`}}),n.trim()}static async callFlowiseAgent(o,n){try{const s=await fetch(o.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:n.trim()})});if(!s.ok)throw new Error(`Error ${s.status}: ${s.statusText}`);return{data:await s.json()}}catch(s){return{data:null,error:s instanceof Error?s.message:"Error desconocido"}}}static async processResponseAgents(o,n,s){let i="";typeof n=="string"?i=n:n!=null&&n.text?i=n.text:i=JSON.stringify(n);const r=o.map(async l=>{try{const a=await this.callFlowiseAgent(l,i);return{agentId:l.id,result:a}}catch(a){return{agentId:l.id,result:{data:null,error:a instanceof Error?a.message:"Error desconocido"}}}}),x=await Promise.all(r),c={};return x.forEach(({agentId:l,result:a})=>{c[l]=a}),c}static formatOCRResult(o){return!o||!o.data?"Sin resultado":typeof o.data=="string"?o.data:o.data.text?o.data.text:o.data.latex?o.data.latex:JSON.stringify(o.data,null,2)}static formatAgentResult(o){var n;return o?o.error?`Error: ${o.error}`:typeof o.data=="string"?o.data:(n=o.data)!=null&&n.text?o.data.text:JSON.stringify(o.data,null,2):"Sin resultado"}}function Y({onFilesSelect:y,maxFiles:o,currentFileCount:n,isProcessing:s,disabled:i=!1}){const r=p.useRef(null),[x,c]=p.useState(!1),l=Math.max(0,o-n),a=l>0&&!i&&!s,t=p.useCallback(g=>{const u=Array.from(g),v=[],R=[];if(u.forEach(w=>{const f=H.validateImageFile(w);f.valid?v.push(w):R.push(`${w.name}: ${f.error}`)}),R.length>0&&alert(`Algunos archivos no son válidos:
${R.join(`
`)}`),v.length>0){const w=v.slice(0,l);y(w),w.length<v.length&&alert(`Se seleccionaron ${w.length} de ${v.length} archivos válidos debido al límite de ${o} imágenes.`)}},[y,l,o]),h=p.useCallback(g=>{g.target.files&&g.target.files.length>0&&t(g.target.files),g.target.value=""},[t]),d=p.useCallback(g=>{if(g.preventDefault(),g.stopPropagation(),c(!1),!a)return;const u=g.dataTransfer.files;u&&u.length>0&&t(u)},[t,a]),C=p.useCallback(g=>{g.preventDefault(),g.stopPropagation()},[]),b=p.useCallback(g=>{g.preventDefault(),g.stopPropagation(),a&&c(!0)},[a]),k=p.useCallback(g=>{g.preventDefault(),g.stopPropagation(),c(!1)},[]),m=p.useCallback(()=>{a&&r.current&&r.current.click()},[a]),S=()=>s?"Procesando...":i?"Deshabilitado":l===0?`Máximo ${o} imágenes alcanzado`:`Selecciona hasta ${l} imagen${l!==1?"es":""} más`,E=()=>s?"text-blue-600":i||l===0?"text-gray-500":"text-gray-700";return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:"Subir Múltiples Imágenes"}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[n,"/",o," imágenes"]})]}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-all duration-200 ${a?x?"border-blue-500 dark:border-blue-400 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 cursor-pointer":"border-gray-300 dark:border-gray-600 cursor-not-allowed opacity-50"}`,onDrop:d,onDragOver:C,onDragEnter:b,onDragLeave:k,onClick:m,children:[e.jsx("div",{className:`w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center ${a?"bg-blue-100 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700"}`,children:e.jsx("svg",{className:`w-8 h-8 ${a?"text-blue-600 dark:text-blue-400":"text-gray-400"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 12l3 3m0 0l3-3m-3 3V9"})})}),e.jsx("p",{className:"text-lg font-medium mb-2",style:{color:a?"var(--color-text-primary)":"var(--color-text-secondary)"},children:x?"Suelta las imágenes aquí":"Arrastra imágenes aquí o haz clic para seleccionar"}),e.jsx("p",{className:`text-sm mb-4 ${E()}`,children:S()}),e.jsx("p",{className:"text-xs mb-4",style:{color:"var(--color-text-secondary)"},children:"Soporta JPG, PNG, GIF, BMP, WebP y PDF (máximo 10MB por archivo)"}),e.jsx("button",{className:`px-6 py-2 rounded-lg transition-colors duration-200 ${a?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,disabled:!a,type:"button",children:s?"Procesando...":"Seleccionar Archivos"})]}),n>0&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-sm text-green-800 dark:text-green-200 font-medium",children:[n," imagen",n!==1?"es":""," seleccionada",n!==1?"s":""]})]})}),e.jsx("input",{ref:r,type:"file",accept:"image/*,.pdf",multiple:!0,onChange:h,className:"hidden",disabled:!a})]})}function Z({onImagesCapture:y,maxFiles:o,currentFileCount:n,isProcessing:s,disabled:i=!1}){const r=p.useRef(null),[x,c]=p.useState(null),[l,a]=p.useState(!1),[t,h]=p.useState([]),{settings:d}=V(),C={width:d.videoConstraints.width,height:d.videoConstraints.height,facingMode:d.videoConstraints.facingMode},b=Math.max(0,o-n),k=b>0&&!i&&!s&&!l,m=p.useCallback(async()=>{if(!(!r.current||!k)){a(!0),c(null);try{await new Promise(v=>setTimeout(v,d.focusDelay*1e3));const u=r.current.getScreenshot({width:d.videoConstraints.width,height:d.videoConstraints.height});if(u){const R=await(await fetch(u)).blob(),w=new File([R],`camera-capture-${Date.now()}.${d.screenshotFormat.split("/")[1]}`,{type:d.screenshotFormat}),f=[...t,w];h(f),f.length>=b&&(y(f),h([]))}}catch(u){c("Error al capturar la imagen"),console.error("Error capturing image:",u)}finally{a(!1)}}},[d,k,t,b,y]),S=p.useCallback(()=>{t.length>0&&(y(t),h([]))},[t,y]),E=p.useCallback(()=>{h([])},[]),g=i||s||l;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:"Capturar con Cámara"}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[n+t.length,"/",o," imágenes"]})]}),x&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-200 rounded-md",children:x}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{ref:r,audio:!1,videoConstraints:C,className:`w-full h-auto rounded-lg ${g?"opacity-50":""}`,style:{maxHeight:"60vh"},onUserMediaError:u=>{c("Error al acceder a la cámara. Verifica los permisos."),console.error("Webcam error:",u)}}),(l||s)&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"text-white text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-2"}),e.jsx("p",{children:l?"Enfocando...":"Procesando..."})]})})]}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:m,disabled:!k,className:`flex-1 px-6 py-3 rounded-lg font-medium transition-colors duration-200 ${k?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,children:l?"Enfocando...":s?"Procesando...":"Capturar Foto"}),t.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:S,disabled:s,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200",children:["Procesar ",t.length," foto",t.length!==1?"s":""]}),e.jsx("button",{onClick:E,disabled:s,className:"px-4 py-3 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200",children:"Limpiar"})]})]}),t.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L3.354 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:[t.length," foto",t.length!==1?"s":""," capturada",t.length!==1?"s":""," pendiente",t.length!==1?"s":""," de procesar"]})]}),e.jsx("div",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:'Haz clic en "Procesar" para agregar a la lista de imágenes o "Capturar Foto" para tomar más.'})]}),e.jsx("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("div",{children:["Resolución: ",d.videoConstraints.width,"x",d.videoConstraints.height]}),e.jsxs("div",{children:["Cámara: ",d.videoConstraints.facingMode==="environment"?"Trasera":"Frontal"]}),e.jsxs("div",{children:["Formato: ",d.screenshotFormat]}),e.jsxs("div",{children:["Calidad: ",d.screenshotQuality]}),e.jsxs("div",{children:["Delay: ",d.focusDelay,"s"]})]})})]})}function B({label:y,selectedAgentId:o,selectedAgentIds:n=[],onAgentSelect:s,onAgentsSelect:i,multiple:r=!1,disabled:x=!1,placeholder:c="Selecciona un agente...",helpText:l,required:a=!1}){var k;const{agents:t,isLoading:h}=P(),d=m=>{s&&s(m)},C=(m,S)=>{i&&i(S?[...n,m]:n.filter(E=>E!==m))},b=()=>{var m;return r?n.map(S=>{var E;return(E=t.find(g=>g.id===S))==null?void 0:E.name}).filter(Boolean).join(", "):((m=t.find(S=>S.id===o))==null?void 0:m.name)||""};return h?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--color-text-primary)"},children:[y," ",a&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700",children:e.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Cargando agentes..."})})]}):t.length===0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--color-text-primary)"},children:[y," ",a&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700",children:e.jsx("span",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"No hay agentes configurados"})}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Ve a Configuración para agregar agentes de Flowise"})]}):r?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--color-text-primary)"},children:[y," ",a&&e.jsx("span",{className:"text-red-500",children:"*"})]}),n.length>0&&e.jsxs("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:[e.jsxs("div",{className:"text-xs text-blue-800 dark:text-blue-200 font-medium mb-1",children:[n.length," agente",n.length!==1?"s":""," seleccionado",n.length!==1?"s":"",":"]}),e.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:b()})]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-2",children:t.map(m=>{const S=n.includes(m.id);return e.jsxs("label",{className:`flex items-start space-x-3 p-2 rounded cursor-pointer transition-colors ${x?"opacity-50 cursor-not-allowed":"hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsx("input",{type:"checkbox",checked:S,onChange:E=>C(m.id,E.target.checked),disabled:x,className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:m.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:m.url})]})]},m.id)})}),l&&e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:l})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--color-text-primary)"},children:[y," ",a&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:o,onChange:m=>d(m.target.value),disabled:x,className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white ${x?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"",children:c}),t.map(m=>e.jsx("option",{value:m.id,children:m.name},m.id))]}),o&&e.jsxs("div",{className:"p-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md",children:[e.jsx("div",{className:"text-xs text-green-800 dark:text-green-200 font-medium",children:"Agente seleccionado:"}),e.jsx("div",{className:"text-xs text-green-700 dark:text-green-300",children:b()}),e.jsx("div",{className:"text-xs text-green-600 dark:text-green-400 truncate mt-1",children:(k=t.find(m=>m.id===o))==null?void 0:k.url})]}),l&&e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:l})]})}function _({images:y,workflowSteps:o,compiledOCRText:n,questionCompilerResult:s,responseAgentsResults:i,isRunning:r}){const{agents:x}=P(),c=t=>{switch(t){case"pending":return e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"⏳"})});case"processing":return e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center",children:e.jsxs("svg",{className:"w-4 h-4 text-blue-600 dark:text-blue-400 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})});case"completed":return e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})});case"error":return e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 dark:bg-red-900 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}},l=t=>{switch(t){case"pending":return"⏳";case"processing":return"🔄";case"completed":return"✅";case"error":return"❌"}},a=(t,h)=>t?`${(((h||new Date).getTime()-t.getTime())/1e3).toFixed(1)}s`:"";return e.jsxs("div",{className:"space-y-6",children:[y.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Estado de las Imágenes"}),e.jsx("div",{className:"space-y-3",children:y.map((t,h)=>{var d;return e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg",style:{backgroundColor:"var(--color-surface)"},children:[e.jsx("span",{className:"text-lg",children:l(t.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:["Imagen #",h+1,": ",t.name]}),e.jsxs("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[(t.size/1024/1024).toFixed(2)," MB"]})]}),t.status==="completed"&&t.ocrResult&&e.jsxs("div",{className:"mt-2 p-2 bg-green-50 dark:bg-green-900/20 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-green-800 dark:text-green-200 mb-1",children:"Resultado OCR:"}),e.jsx("div",{className:"text-green-700 dark:text-green-300 max-h-20 overflow-y-auto",children:W.formatOCRResult(t.ocrResult)})]}),t.status==="error"&&((d=t.ocrResult)==null?void 0:d.error)&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 dark:bg-red-900/20 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-red-800 dark:text-red-200 mb-1",children:"Error:"}),e.jsx("div",{className:"text-red-700 dark:text-red-300",children:t.ocrResult.error})]})]})]},t.id)})})]}),o.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Progreso del Workflow"}),e.jsx("div",{className:"space-y-4",children:o.map((t,h)=>e.jsxs("div",{className:"flex items-start space-x-4",children:[c(t.status),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:t.name}),t.startTime&&e.jsx("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:a(t.startTime,t.endTime)})]}),t.status==="error"&&t.error&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",children:[e.jsx("div",{className:"text-sm text-red-800 dark:text-red-200 font-medium",children:"Error:"}),e.jsx("div",{className:"text-sm text-red-700 dark:text-red-300",children:t.error})]}),t.status==="completed"&&t.result&&e.jsx("div",{className:"mt-2 text-xs",style:{color:"var(--color-text-secondary)"},children:"✓ Completado exitosamente"})]}),h<o.length-1&&e.jsx("div",{className:"absolute left-4 top-8 w-px h-6 bg-gray-300 dark:bg-gray-600",style:{marginTop:"2rem"}})]},t.id))})]}),n&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Texto OCR Compilado"}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:e.jsx("pre",{className:"text-sm whitespace-pre-wrap overflow-x-auto",style:{color:"var(--color-text-primary)"},children:n})})]}),s&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Resultado del Agente Compilador"}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsx("pre",{className:"text-sm whitespace-pre-wrap overflow-x-auto text-blue-800 dark:text-blue-200",children:W.formatAgentResult(s)})})]}),Object.keys(i).length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Resultados de Agentes de Respuesta"}),e.jsx("div",{className:"space-y-4",children:Object.entries(i).map(([t,h])=>{const d=x.find(b=>b.id===t),C=d?d.name:`Agente ${t}`;return e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-purple-800 dark:text-purple-200 mb-2",children:C}),d&&e.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-400 mb-2 truncate",children:d.url}),e.jsx("pre",{className:"text-sm whitespace-pre-wrap overflow-x-auto text-purple-700 dark:text-purple-300",children:W.formatAgentResult(h)})]},t)})})]}),r&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"Ejecutando workflow..."})]})})]})}function ee({imagesCount:y,maxImages:o,isRunning:n,canRunWorkflow:s,onTakePhoto:i,onRunWorkflow:r,onReset:x}){const{settings:c}=V(),l=p.useRef(null),a=y<o&&!n,t=p.useCallback(async()=>{if(!(!a||!l.current))try{await new Promise(C=>setTimeout(C,c.focusDelay*1e3));const d=l.current.getScreenshot({width:c.videoConstraints.width,height:c.videoConstraints.height});if(d){const b=await(await fetch(d)).blob(),k=new File([b],`camera-capture-${Date.now()}.${c.screenshotFormat.split("/")[1]}`,{type:c.screenshotFormat});i(k)}}catch(d){console.error("Error en captura automática:",d)}},[c,a,i]),h=p.useCallback(()=>{s&&r()},[s,r]);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-700 mb-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"⚡ Atajos de Ejecución"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("button",{onClick:t,disabled:!a,className:`px-4 py-3 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center space-x-2 ${a?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,children:[e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:"Tomar Foto"})]}),e.jsxs("button",{onClick:h,disabled:!s,className:`px-4 py-3 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center space-x-2 ${s?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsx("span",{children:"Procesar y Limpiar"})]})]}),e.jsxs("button",{onClick:x,className:"w-full px-4 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors duration-200 flex items-center justify-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:n?"Cancelar Workflow":"Reiniciar"})]}),e.jsx("div",{className:"mt-3 text-xs",style:{color:"var(--color-text-secondary)"},children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Imágenes: ",y,"/",o]}),e.jsxs("span",{children:["Estado: ",n?"Ejecutando...":"Listo"]})]})}),e.jsx("div",{className:"hidden",children:e.jsx(q,{ref:l,audio:!1,videoConstraints:{width:c.videoConstraints.width,height:c.videoConstraints.height,facingMode:c.videoConstraints.facingMode},onUserMediaError:d=>{console.error("Webcam error:",d)}})})]})}function ie({}){return[{title:"Multi-OCR Workflow - Procesamiento Avanzado"},{name:"description",content:"Workflow avanzado para procesar múltiples imágenes con OCR y agentes de IA"}]}const le=K(function(){const{config:o,updateConfig:n,saveConfig:s,images:i,addImages:r,removeImage:x,clearImages:c,updateImageStatus:l,workflowSteps:a,updateWorkflowStep:t,initializeWorkflowSteps:h,resetWorkflow:d,compiledOCRText:C,setCompiledOCRText:b,questionCompilerResult:k,setQuestionCompilerResult:m,responseAgentsResults:S,setResponseAgentResult:E,clearResults:g,isRunning:u,setIsRunning:v,cancelWorkflow:R}=Q(),{agents:w}=P(),{settings:f}=X(),[I,F]=p.useState(!1),M=j=>{const A={...o,questionCompilerAgentId:j};n(A),s(A)},J=j=>{const A={...o,responseAgentIds:j};n(A),s(A)},D=p.useCallback(()=>{const j=[];return(!f.appId||!f.appKey)&&j.push("Configuración de Mathpix incompleta"),o.questionCompilerAgentId||j.push("Agente compilador de preguntas no seleccionado"),o.responseAgentIds.length===0&&j.push("No hay agentes de respuesta seleccionados"),i.length===0&&j.push("No hay imágenes para procesar"),F(j.length>0),j},[f,o,i]),$=p.useCallback(async()=>{const j=D();if(j.length>0){alert(`No se puede ejecutar el workflow:
${j.join(`
`)}`);return}v(!0),g(),h();try{const A=w.find(N=>N.id===o.questionCompilerAgentId),G=w.filter(N=>o.responseAgentIds.includes(N.id));if(!A)throw new Error("Agente compilador no encontrado");const L=await W.processWorkflow(i,A,G,{appId:f.appId,appKey:f.appKey,includeMath:f.includeMath,outputFormats:f.outputFormats},{onImageOCRStart:N=>{l(N,"processing")},onImageOCRComplete:(N,O)=>{l(N,"completed",O)},onImageOCRError:(N,O)=>{l(N,"error",{status:0,data:null,error:O})},onStepStart:N=>{t(N,{status:"processing",startTime:new Date})},onStepComplete:(N,O)=>{t(N,{status:"completed",endTime:new Date,result:O})},onStepError:(N,O)=>{t(N,{status:"error",endTime:new Date,error:O})}});L.success?(b(L.compiledOCRText),m(L.questionCompilerResult),Object.entries(L.responseAgentsResults).forEach(([N,O])=>{E(N,O)})):alert(`Error en el workflow: ${L.error}`)}catch(A){console.error("Error executing workflow:",A),alert(`Error inesperado: ${A instanceof Error?A.message:"Error desconocido"}`)}finally{v(!1)}},[D,w,o,i,f,g,h,l,t,b,m,E]),U=p.useCallback(async()=>{await $(),setTimeout(()=>{d()},2e3)},[$,d]),T=()=>{u?R():d()},z=!u&&!I&&i.length>0&&o.questionCompilerAgentId&&o.responseAgentIds.length>0;return e.jsxs("div",{className:"min-h-screen pb-20",style:{backgroundColor:"var(--color-background)"},children:[e.jsxs("div",{className:"shadow-sm border-b px-4 py-4",style:{backgroundColor:"var(--color-surface)",borderColor:"var(--color-border)"},children:[e.jsx("h1",{className:"text-xl font-semibold",style:{color:"var(--color-text-primary)"},children:"⚡ Multi-OCR Workflow"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:"Procesamiento avanzado con múltiples imágenes OCR y agentes de IA"})]}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx(ee,{imagesCount:i.length,maxImages:o.maxImages,isRunning:u,canRunWorkflow:z,onTakePhoto:j=>r([j]),onRunWorkflow:U,onReset:T}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Configuración del Workflow"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(B,{label:"Agente Compilador de Preguntas",selectedAgentId:o.questionCompilerAgentId,onAgentSelect:M,placeholder:"Selecciona el agente compilador...",helpText:"Este agente procesará el texto OCR compilado y generará una pregunta.",required:!0,disabled:u}),e.jsx(B,{label:"Agentes de Respuesta",selectedAgentIds:o.responseAgentIds,onAgentsSelect:J,multiple:!0,helpText:"Estos agentes procesarán la respuesta del agente compilador en paralelo.",required:!0,disabled:u})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-2",children:I?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L3.354 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"Configuración incompleta"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-green-700 dark:text-green-300",children:"Configuración completa"})]})}),e.jsxs("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["Máximo ",o.maxImages," imágenes"]})]})]}),e.jsx(Y,{onFilesSelect:r,maxFiles:o.maxImages,currentFileCount:i.length,isProcessing:u,disabled:u}),e.jsx(Z,{onImagesCapture:r,maxFiles:o.maxImages,currentFileCount:i.length,isProcessing:u,disabled:u}),i.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:["Imágenes Seleccionadas (",i.length,")"]}),e.jsx("button",{onClick:c,disabled:u,className:"px-3 py-1 text-sm bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded-md transition-colors duration-200",children:"Limpiar Todo"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map((j,A)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:["#",A+1]}),e.jsx("button",{onClick:()=>x(j.id),disabled:u,className:"text-red-600 hover:text-red-700 disabled:text-gray-400",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 truncate mb-1",children:j.name}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(j.size/1024/1024).toFixed(2)," MB"]})]},j.id))})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:$,disabled:!z,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200 flex items-center justify-center",children:u?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Ejecutando Workflow..."]}):"Ejecutar Workflow"}),e.jsx("button",{onClick:T,disabled:u,className:"px-6 py-3 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200",children:"Reiniciar"})]}),e.jsx(_,{images:i,workflowSteps:a,compiledOCRText:C,questionCompilerResult:k,responseAgentsResults:S,isRunning:u}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-blue-800 dark:text-blue-200 mb-3",children:"¿Cómo funciona el Multi-OCR Workflow?"}),e.jsxs("div",{className:"space-y-3 text-sm text-blue-700 dark:text-blue-300",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"1"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Captura de Imágenes:"})," Sube archivos desde tu dispositivo o captura fotos con la cámara (hasta ",o.maxImages," imágenes)."]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"2"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Procesamiento OCR:"})," Las imágenes se procesan en paralelo con Mathpix OCR para extraer texto y fórmulas."]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"3"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Compilación:"}),' Los resultados OCR se compilan en un texto estructurado con formato "OCR #1 ',"{","texto","}",' FIN OCR #1".']})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"4"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Agente Compilador:"})," El texto compilado se envía al agente compilador que genera una pregunta o consulta procesada."]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Agentes de Respuesta:"})," La respuesta del compilador se envía en paralelo a múltiples agentes especializados."]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-100 dark:bg-blue-800/30 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-2",children:"💡 Consejos para mejores resultados:"}),e.jsxs("ul",{className:"text-xs text-blue-700 dark:text-blue-300 space-y-1",children:[e.jsx("li",{children:"• Usa la cámara para capturar pantallas de notebook con tu celular"}),e.jsx("li",{children:"• Configura la resolución y delay de enfoque en Configuración"}),e.jsx("li",{children:"• Asegúrate de que el texto sea legible y esté bien iluminado"}),e.jsx("li",{children:"• Puedes combinar archivos subidos con fotos capturadas"})]})]})]})]})]})});export{le as default,ie as meta};
