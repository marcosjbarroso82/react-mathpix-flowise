import{a as p,p as e,w as V}from"./chunk-B7RQU5TL-xj-QjgGV.js";import{u as J}from"./MultiOCRWorkflowContext-BR-qGant.js";import{u as $}from"./FlowiseAgentsContext-DaThIt2D.js";import{u as G}from"./MathpixSettingsContext-C5kfmVKl.js";import{M as T}from"./mathpixService-BVSjE40i.js";import{W as K}from"./react-webcam-Cv0vQhem.js";import{u as Q}from"./CameraSettingsContext-BDn7_6_x.js";class L{static async processWorkflow(s,n,o,d,r){var x,h,i,a,t,u,l,k,w,O,c,C,S,m,f;try{(x=r==null?void 0:r.onStepStart)==null||x.call(r,"ocr-processing"),(h=r==null?void 0:r.onProgress)==null||h.call(r,1,4,"Procesando OCR de imágenes...");const g=await this.processImagesOCR(s,d,r);if(g.some(A=>A.error)){const A="Error en procesamiento OCR de algunas imágenes";throw(i=r==null?void 0:r.onStepError)==null||i.call(r,"ocr-processing",A),new Error(A)}(a=r==null?void 0:r.onStepComplete)==null||a.call(r,"ocr-processing",g),(t=r==null?void 0:r.onStepStart)==null||t.call(r,"ocr-compilation"),(u=r==null?void 0:r.onProgress)==null||u.call(r,2,4,"Compilando resultados OCR...");const b=this.compileOCRResults(g);(l=r==null?void 0:r.onStepComplete)==null||l.call(r,"ocr-compilation",{compiledText:b}),(k=r==null?void 0:r.onStepStart)==null||k.call(r,"question-compiler"),(w=r==null?void 0:r.onProgress)==null||w.call(r,3,4,"Procesando con agente compilador...");const E=await this.callFlowiseAgent(n,b);if(E.error)throw(O=r==null?void 0:r.onStepError)==null||O.call(r,"question-compiler",E.error),new Error(`Error en agente compilador: ${E.error}`);(c=r==null?void 0:r.onStepComplete)==null||c.call(r,"question-compiler",E),(C=r==null?void 0:r.onStepStart)==null||C.call(r,"response-agents"),(S=r==null?void 0:r.onProgress)==null||S.call(r,4,4,"Procesando con agentes de respuesta...");const I=await this.processResponseAgents(o,E.data,r);return Object.values(I).some(A=>A.error)&&((m=r==null?void 0:r.onStepError)==null||m.call(r,"response-agents","Error en algunos agentes de respuesta")),(f=r==null?void 0:r.onStepComplete)==null||f.call(r,"response-agents",I),{compiledOCRText:b,questionCompilerResult:E,responseAgentsResults:I,success:!0}}catch(g){return console.error("Error in MultiOCR Workflow:",g),{compiledOCRText:"",questionCompilerResult:null,responseAgentsResults:{},success:!1,error:g instanceof Error?g.message:"Error desconocido"}}}static async processImagesOCR(s,n,o){const d=s.map(async r=>{var x,h,i,a;try{(x=o==null?void 0:o.onImageOCRStart)==null||x.call(o,r.id);const t=await T.processImage(r.file,n);return t.error?((h=o==null?void 0:o.onImageOCRError)==null||h.call(o,r.id,t.error),{imageId:r.id,result:null,error:t.error}):((i=o==null?void 0:o.onImageOCRComplete)==null||i.call(o,r.id,t),{imageId:r.id,result:t})}catch(t){const u=t instanceof Error?t.message:"Error desconocido";return(a=o==null?void 0:o.onImageOCRError)==null||a.call(o,r.id,u),{imageId:r.id,result:null,error:u}}});return Promise.all(d)}static compileOCRResults(s){let n="";return s.forEach((o,d)=>{if(o.result&&!o.error){const r=d+1;let x="";o.result.data&&(typeof o.result.data=="string"?x=o.result.data:o.result.data.text?x=o.result.data.text:o.result.data.latex?x=o.result.data.latex:x=JSON.stringify(o.result.data)),n+=`OCR #${r} ${x} FIN OCR #${r}

`}}),n.trim()}static async callFlowiseAgent(s,n){try{const o=await fetch(s.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:n.trim()})});if(!o.ok)throw new Error(`Error ${o.status}: ${o.statusText}`);return{data:await o.json()}}catch(o){return{data:null,error:o instanceof Error?o.message:"Error desconocido"}}}static async processResponseAgents(s,n,o){let d="";typeof n=="string"?d=n:n!=null&&n.text?d=n.text:d=JSON.stringify(n);const r=s.map(async i=>{try{const a=await this.callFlowiseAgent(i,d);return{agentId:i.id,result:a}}catch(a){return{agentId:i.id,result:{data:null,error:a instanceof Error?a.message:"Error desconocido"}}}}),x=await Promise.all(r),h={};return x.forEach(({agentId:i,result:a})=>{h[i]=a}),h}static formatOCRResult(s){return!s||!s.data?"Sin resultado":typeof s.data=="string"?s.data:s.data.text?s.data.text:s.data.latex?s.data.latex:JSON.stringify(s.data,null,2)}static formatAgentResult(s){var n;return s?s.error?`Error: ${s.error}`:typeof s.data=="string"?s.data:(n=s.data)!=null&&n.text?s.data.text:JSON.stringify(s.data,null,2):"Sin resultado"}}function U({onFilesSelect:v,maxFiles:s,currentFileCount:n,isProcessing:o,disabled:d=!1}){const r=p.useRef(null),[x,h]=p.useState(!1),i=Math.max(0,s-n),a=i>0&&!d&&!o,t=p.useCallback(m=>{const f=Array.from(m),g=[],y=[];if(f.forEach(b=>{const E=T.validateImageFile(b);E.valid?g.push(b):y.push(`${b.name}: ${E.error}`)}),y.length>0&&alert(`Algunos archivos no son válidos:
${y.join(`
`)}`),g.length>0){const b=g.slice(0,i);v(b),b.length<g.length&&alert(`Se seleccionaron ${b.length} de ${g.length} archivos válidos debido al límite de ${s} imágenes.`)}},[v,i,s]),u=p.useCallback(m=>{m.target.files&&m.target.files.length>0&&t(m.target.files),m.target.value=""},[t]),l=p.useCallback(m=>{if(m.preventDefault(),m.stopPropagation(),h(!1),!a)return;const f=m.dataTransfer.files;f&&f.length>0&&t(f)},[t,a]),k=p.useCallback(m=>{m.preventDefault(),m.stopPropagation()},[]),w=p.useCallback(m=>{m.preventDefault(),m.stopPropagation(),a&&h(!0)},[a]),O=p.useCallback(m=>{m.preventDefault(),m.stopPropagation(),h(!1)},[]),c=p.useCallback(()=>{a&&r.current&&r.current.click()},[a]),C=()=>o?"Procesando...":d?"Deshabilitado":i===0?`Máximo ${s} imágenes alcanzado`:`Selecciona hasta ${i} imagen${i!==1?"es":""} más`,S=()=>o?"text-blue-600":d||i===0?"text-gray-500":"text-gray-700";return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:"Subir Múltiples Imágenes"}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[n,"/",s," imágenes"]})]}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-all duration-200 ${a?x?"border-blue-500 dark:border-blue-400 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 cursor-pointer":"border-gray-300 dark:border-gray-600 cursor-not-allowed opacity-50"}`,onDrop:l,onDragOver:k,onDragEnter:w,onDragLeave:O,onClick:c,children:[e.jsx("div",{className:`w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center ${a?"bg-blue-100 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700"}`,children:e.jsx("svg",{className:`w-8 h-8 ${a?"text-blue-600 dark:text-blue-400":"text-gray-400"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 12l3 3m0 0l3-3m-3 3V9"})})}),e.jsx("p",{className:"text-lg font-medium mb-2",style:{color:a?"var(--color-text-primary)":"var(--color-text-secondary)"},children:x?"Suelta las imágenes aquí":"Arrastra imágenes aquí o haz clic para seleccionar"}),e.jsx("p",{className:`text-sm mb-4 ${S()}`,children:C()}),e.jsx("p",{className:"text-xs mb-4",style:{color:"var(--color-text-secondary)"},children:"Soporta JPG, PNG, GIF, BMP, WebP y PDF (máximo 10MB por archivo)"}),e.jsx("button",{className:`px-6 py-2 rounded-lg transition-colors duration-200 ${a?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,disabled:!a,type:"button",children:o?"Procesando...":"Seleccionar Archivos"})]}),n>0&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-sm text-green-800 dark:text-green-200 font-medium",children:[n," imagen",n!==1?"es":""," seleccionada",n!==1?"s":""]})]})}),e.jsx("input",{ref:r,type:"file",accept:"image/*,.pdf",multiple:!0,onChange:u,className:"hidden",disabled:!a})]})}function X({onImagesCapture:v,maxFiles:s,currentFileCount:n,isProcessing:o,disabled:d=!1}){const r=p.useRef(null),[x,h]=p.useState(null),[i,a]=p.useState(!1),[t,u]=p.useState([]),{settings:l}=Q(),k={width:l.videoConstraints.width,height:l.videoConstraints.height,facingMode:l.videoConstraints.facingMode},w=Math.max(0,s-n),O=w>0&&!d&&!o&&!i,c=p.useCallback(async()=>{if(!(!r.current||!O)){a(!0),h(null);try{await new Promise(g=>setTimeout(g,l.focusDelay*1e3));const f=r.current.getScreenshot({width:l.videoConstraints.width,height:l.videoConstraints.height});if(f){const y=await(await fetch(f)).blob(),b=new File([y],`camera-capture-${Date.now()}.${l.screenshotFormat.split("/")[1]}`,{type:l.screenshotFormat}),E=[...t,b];u(E),E.length>=w&&(v(E),u([]))}}catch(f){h("Error al capturar la imagen"),console.error("Error capturing image:",f)}finally{a(!1)}}},[l,O,t,w,v]),C=p.useCallback(()=>{t.length>0&&(v(t),u([]))},[t,v]),S=p.useCallback(()=>{u([])},[]),m=d||o||i;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:"Capturar con Cámara"}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[n+t.length,"/",s," imágenes"]})]}),x&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-200 rounded-md",children:x}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{ref:r,audio:!1,videoConstraints:k,className:`w-full h-auto rounded-lg ${m?"opacity-50":""}`,style:{maxHeight:"60vh"},onUserMediaError:f=>{h("Error al acceder a la cámara. Verifica los permisos."),console.error("Webcam error:",f)}}),(i||o)&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"text-white text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-2"}),e.jsx("p",{children:i?"Enfocando...":"Procesando..."})]})})]}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:c,disabled:!O,className:`flex-1 px-6 py-3 rounded-lg font-medium transition-colors duration-200 ${O?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,children:i?"Enfocando...":o?"Procesando...":"Capturar Foto"}),t.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:C,disabled:o,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200",children:["Procesar ",t.length," foto",t.length!==1?"s":""]}),e.jsx("button",{onClick:S,disabled:o,className:"px-4 py-3 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200",children:"Limpiar"})]})]}),t.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L3.354 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:[t.length," foto",t.length!==1?"s":""," capturada",t.length!==1?"s":""," pendiente",t.length!==1?"s":""," de procesar"]})]}),e.jsx("div",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:'Haz clic en "Procesar" para agregar a la lista de imágenes o "Capturar Foto" para tomar más.'})]}),e.jsx("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("div",{children:["Resolución: ",l.videoConstraints.width,"x",l.videoConstraints.height]}),e.jsxs("div",{children:["Cámara: ",l.videoConstraints.facingMode==="environment"?"Trasera":"Frontal"]}),e.jsxs("div",{children:["Formato: ",l.screenshotFormat]}),e.jsxs("div",{children:["Calidad: ",l.screenshotQuality]}),e.jsxs("div",{children:["Delay: ",l.focusDelay,"s"]})]})})]})}function F({label:v,selectedAgentId:s,selectedAgentIds:n=[],onAgentSelect:o,onAgentsSelect:d,multiple:r=!1,disabled:x=!1,placeholder:h="Selecciona un agente...",helpText:i,required:a=!1}){var O;const{agents:t,isLoading:u}=$(),l=c=>{o&&o(c)},k=(c,C)=>{d&&d(C?[...n,c]:n.filter(S=>S!==c))},w=()=>{var c;return r?n.map(C=>{var S;return(S=t.find(m=>m.id===C))==null?void 0:S.name}).filter(Boolean).join(", "):((c=t.find(C=>C.id===s))==null?void 0:c.name)||""};return u?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--color-text-primary)"},children:[v," ",a&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700",children:e.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Cargando agentes..."})})]}):t.length===0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--color-text-primary)"},children:[v," ",a&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700",children:e.jsx("span",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"No hay agentes configurados"})}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Ve a Configuración para agregar agentes de Flowise"})]}):r?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--color-text-primary)"},children:[v," ",a&&e.jsx("span",{className:"text-red-500",children:"*"})]}),n.length>0&&e.jsxs("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:[e.jsxs("div",{className:"text-xs text-blue-800 dark:text-blue-200 font-medium mb-1",children:[n.length," agente",n.length!==1?"s":""," seleccionado",n.length!==1?"s":"",":"]}),e.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:w()})]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-2",children:t.map(c=>{const C=n.includes(c.id);return e.jsxs("label",{className:`flex items-start space-x-3 p-2 rounded cursor-pointer transition-colors ${x?"opacity-50 cursor-not-allowed":"hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsx("input",{type:"checkbox",checked:C,onChange:S=>k(c.id,S.target.checked),disabled:x,className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:c.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:c.url})]})]},c.id)})}),i&&e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:i})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium",style:{color:"var(--color-text-primary)"},children:[v," ",a&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:s,onChange:c=>l(c.target.value),disabled:x,className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white ${x?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"",children:h}),t.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]}),s&&e.jsxs("div",{className:"p-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md",children:[e.jsx("div",{className:"text-xs text-green-800 dark:text-green-200 font-medium",children:"Agente seleccionado:"}),e.jsx("div",{className:"text-xs text-green-700 dark:text-green-300",children:w()}),e.jsx("div",{className:"text-xs text-green-600 dark:text-green-400 truncate mt-1",children:(O=t.find(c=>c.id===s))==null?void 0:O.url})]}),i&&e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:i})]})}function Y({images:v,workflowSteps:s,compiledOCRText:n,questionCompilerResult:o,responseAgentsResults:d,isRunning:r}){const{agents:x}=$(),h=t=>{switch(t){case"pending":return e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"⏳"})});case"processing":return e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center",children:e.jsxs("svg",{className:"w-4 h-4 text-blue-600 dark:text-blue-400 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})});case"completed":return e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})});case"error":return e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 dark:bg-red-900 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}},i=t=>{switch(t){case"pending":return"⏳";case"processing":return"🔄";case"completed":return"✅";case"error":return"❌"}},a=(t,u)=>t?`${(((u||new Date).getTime()-t.getTime())/1e3).toFixed(1)}s`:"";return e.jsxs("div",{className:"space-y-6",children:[v.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Estado de las Imágenes"}),e.jsx("div",{className:"space-y-3",children:v.map((t,u)=>{var l;return e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg",style:{backgroundColor:"var(--color-surface)"},children:[e.jsx("span",{className:"text-lg",children:i(t.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:["Imagen #",u+1,": ",t.name]}),e.jsxs("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[(t.size/1024/1024).toFixed(2)," MB"]})]}),t.status==="completed"&&t.ocrResult&&e.jsxs("div",{className:"mt-2 p-2 bg-green-50 dark:bg-green-900/20 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-green-800 dark:text-green-200 mb-1",children:"Resultado OCR:"}),e.jsx("div",{className:"text-green-700 dark:text-green-300 max-h-20 overflow-y-auto",children:L.formatOCRResult(t.ocrResult)})]}),t.status==="error"&&((l=t.ocrResult)==null?void 0:l.error)&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 dark:bg-red-900/20 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-red-800 dark:text-red-200 mb-1",children:"Error:"}),e.jsx("div",{className:"text-red-700 dark:text-red-300",children:t.ocrResult.error})]})]})]},t.id)})})]}),s.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Progreso del Workflow"}),e.jsx("div",{className:"space-y-4",children:s.map((t,u)=>e.jsxs("div",{className:"flex items-start space-x-4",children:[h(t.status),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:t.name}),t.startTime&&e.jsx("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:a(t.startTime,t.endTime)})]}),t.status==="error"&&t.error&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",children:[e.jsx("div",{className:"text-sm text-red-800 dark:text-red-200 font-medium",children:"Error:"}),e.jsx("div",{className:"text-sm text-red-700 dark:text-red-300",children:t.error})]}),t.status==="completed"&&t.result&&e.jsx("div",{className:"mt-2 text-xs",style:{color:"var(--color-text-secondary)"},children:"✓ Completado exitosamente"})]}),u<s.length-1&&e.jsx("div",{className:"absolute left-4 top-8 w-px h-6 bg-gray-300 dark:bg-gray-600",style:{marginTop:"2rem"}})]},t.id))})]}),n&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Texto OCR Compilado"}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:e.jsx("pre",{className:"text-sm whitespace-pre-wrap overflow-x-auto",style:{color:"var(--color-text-primary)"},children:n})})]}),o&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Resultado del Agente Compilador"}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsx("pre",{className:"text-sm whitespace-pre-wrap overflow-x-auto text-blue-800 dark:text-blue-200",children:L.formatAgentResult(o)})})]}),Object.keys(d).length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Resultados de Agentes de Respuesta"}),e.jsx("div",{className:"space-y-4",children:Object.entries(d).map(([t,u])=>{const l=x.find(w=>w.id===t),k=l?l.name:`Agente ${t}`;return e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-purple-800 dark:text-purple-200 mb-2",children:k}),l&&e.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-400 mb-2 truncate",children:l.url}),e.jsx("pre",{className:"text-sm whitespace-pre-wrap overflow-x-auto text-purple-700 dark:text-purple-300",children:L.formatAgentResult(u)})]},t)})})]}),r&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"Ejecutando workflow..."})]})})]})}function ne({}){return[{title:"Multi-OCR Workflow - Procesamiento Avanzado"},{name:"description",content:"Workflow avanzado para procesar múltiples imágenes con OCR y agentes de IA"}]}const ae=V(function(){const{config:s,updateConfig:n,saveConfig:o,images:d,addImages:r,removeImage:x,clearImages:h,updateImageStatus:i,workflowSteps:a,updateWorkflowStep:t,initializeWorkflowSteps:u,resetWorkflow:l,compiledOCRText:k,setCompiledOCRText:w,questionCompilerResult:O,setQuestionCompilerResult:c,responseAgentsResults:C,setResponseAgentResult:S,clearResults:m}=J(),{agents:f}=$(),{settings:g}=G(),[y,b]=p.useState(!1),[E,I]=p.useState(!1),P=j=>{const R={...s,questionCompilerAgentId:j};n(R),o(R)},A=j=>{const R={...s,responseAgentIds:j};n(R),o(R)},D=p.useCallback(()=>{const j=[];return(!g.appId||!g.appKey)&&j.push("Configuración de Mathpix incompleta"),s.questionCompilerAgentId||j.push("Agente compilador de preguntas no seleccionado"),s.responseAgentIds.length===0&&j.push("No hay agentes de respuesta seleccionados"),d.length===0&&j.push("No hay imágenes para procesar"),I(j.length>0),j},[g,s,d]),z=p.useCallback(async()=>{const j=D();if(j.length>0){alert(`No se puede ejecutar el workflow:
${j.join(`
`)}`);return}b(!0),m(),u();try{const R=f.find(N=>N.id===s.questionCompilerAgentId),H=f.filter(N=>s.responseAgentIds.includes(N.id));if(!R)throw new Error("Agente compilador no encontrado");const W=await L.processWorkflow(d,R,H,{appId:g.appId,appKey:g.appKey,includeMath:g.includeMath,outputFormats:g.outputFormats},{onImageOCRStart:N=>{i(N,"processing")},onImageOCRComplete:(N,M)=>{i(N,"completed",M)},onImageOCRError:(N,M)=>{i(N,"error",{status:0,data:null,error:M})},onStepStart:N=>{t(N,{status:"processing",startTime:new Date})},onStepComplete:(N,M)=>{t(N,{status:"completed",endTime:new Date,result:M})},onStepError:(N,M)=>{t(N,{status:"error",endTime:new Date,error:M})}});W.success?(w(W.compiledOCRText),c(W.questionCompilerResult),Object.entries(W.responseAgentsResults).forEach(([N,M])=>{S(N,M)})):alert(`Error en el workflow: ${W.error}`)}catch(R){console.error("Error executing workflow:",R),alert(`Error inesperado: ${R instanceof Error?R.message:"Error desconocido"}`)}finally{b(!1)}},[D,f,s,d,g,m,u,i,t,w,c,S]),B=()=>{window.confirm("¿Estás seguro de que quieres reiniciar el workflow? Se perderán todos los resultados.")&&(l(),b(!1))},q=!y&&!E&&d.length>0&&s.questionCompilerAgentId&&s.responseAgentIds.length>0;return e.jsxs("div",{className:"min-h-screen pb-20",style:{backgroundColor:"var(--color-background)"},children:[e.jsxs("div",{className:"shadow-sm border-b px-4 py-4",style:{backgroundColor:"var(--color-surface)",borderColor:"var(--color-border)"},children:[e.jsx("h1",{className:"text-xl font-semibold",style:{color:"var(--color-text-primary)"},children:"⚡ Multi-OCR Workflow"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:"Procesamiento avanzado con múltiples imágenes OCR y agentes de IA"})]}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Configuración del Workflow"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(F,{label:"Agente Compilador de Preguntas",selectedAgentId:s.questionCompilerAgentId,onAgentSelect:P,placeholder:"Selecciona el agente compilador...",helpText:"Este agente procesará el texto OCR compilado y generará una pregunta.",required:!0,disabled:y}),e.jsx(F,{label:"Agentes de Respuesta",selectedAgentIds:s.responseAgentIds,onAgentsSelect:A,multiple:!0,helpText:"Estos agentes procesarán la respuesta del agente compilador en paralelo.",required:!0,disabled:y})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-2",children:E?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L3.354 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"Configuración incompleta"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-green-700 dark:text-green-300",children:"Configuración completa"})]})}),e.jsxs("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["Máximo ",s.maxImages," imágenes"]})]})]}),e.jsx(U,{onFilesSelect:r,maxFiles:s.maxImages,currentFileCount:d.length,isProcessing:y,disabled:y}),e.jsx(X,{onImagesCapture:r,maxFiles:s.maxImages,currentFileCount:d.length,isProcessing:y,disabled:y}),d.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:["Imágenes Seleccionadas (",d.length,")"]}),e.jsx("button",{onClick:h,disabled:y,className:"px-3 py-1 text-sm bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded-md transition-colors duration-200",children:"Limpiar Todo"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map((j,R)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:["#",R+1]}),e.jsx("button",{onClick:()=>x(j.id),disabled:y,className:"text-red-600 hover:text-red-700 disabled:text-gray-400",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 truncate mb-1",children:j.name}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(j.size/1024/1024).toFixed(2)," MB"]})]},j.id))})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:z,disabled:!q,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200 flex items-center justify-center",children:y?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Ejecutando Workflow..."]}):"Ejecutar Workflow"}),e.jsx("button",{onClick:B,disabled:y,className:"px-6 py-3 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200",children:"Reiniciar"})]}),e.jsx(Y,{images:d,workflowSteps:a,compiledOCRText:k,questionCompilerResult:O,responseAgentsResults:C,isRunning:y}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-blue-800 dark:text-blue-200 mb-3",children:"¿Cómo funciona el Multi-OCR Workflow?"}),e.jsxs("div",{className:"space-y-3 text-sm text-blue-700 dark:text-blue-300",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"1"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Captura de Imágenes:"})," Sube archivos desde tu dispositivo o captura fotos con la cámara (hasta ",s.maxImages," imágenes)."]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"2"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Procesamiento OCR:"})," Las imágenes se procesan en paralelo con Mathpix OCR para extraer texto y fórmulas."]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"3"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Compilación:"}),' Los resultados OCR se compilan en un texto estructurado con formato "OCR #1 ',"{","texto","}",' FIN OCR #1".']})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"4"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Agente Compilador:"})," El texto compilado se envía al agente compilador que genera una pregunta o consulta procesada."]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-800 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 dark:text-blue-200",children:"5"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Agentes de Respuesta:"})," La respuesta del compilador se envía en paralelo a múltiples agentes especializados."]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-100 dark:bg-blue-800/30 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-2",children:"💡 Consejos para mejores resultados:"}),e.jsxs("ul",{className:"text-xs text-blue-700 dark:text-blue-300 space-y-1",children:[e.jsx("li",{children:"• Usa la cámara para capturar pantallas de notebook con tu celular"}),e.jsx("li",{children:"• Configura la resolución y delay de enfoque en Configuración"}),e.jsx("li",{children:"• Asegúrate de que el texto sea legible y esté bien iluminado"}),e.jsx("li",{children:"• Puedes combinar archivos subidos con fotos capturadas"})]})]})]})]})]})});export{ae as default,ne as meta};
